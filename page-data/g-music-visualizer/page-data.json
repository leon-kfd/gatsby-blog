{"componentChunkName":"component---src-templates-blog-post-js","path":"/g-music-visualizer/","result":{"data":{"site":{"siteMetadata":{"title":"Howdy"}},"markdownRemark":{"id":"44344ac0-ea1e-5763-a8d2-16b45c2372d3","excerpt":"åˆ©ç”¨é˜¿é‡ŒAntviså‡ºå“çš„Gåº•å±‚å›¾å½¢æ¸²æŸ“å™¨ï¼Œç»“åˆAudioContextæä¾›çš„éŸ³é¢‘æ•°æ®è·å–APIï¼Œå®ç°å‡ºç±»ä¼¼ç½‘æ˜“äº‘æ’­æ”¾éŸ³é¢‘ç‰¹æ•ˆã€‚ é¡¹ç›®åœ°å€ï¼š âš¡Github ğŸ’¡Demo å…³äºGæ¸²æŸ“å™¨ æ˜¯ä¸€æ¬¾æ˜“ç”¨ã€é«˜æ•ˆã€å¼ºå¤§çš„ 2D å¯è§†åŒ–æ¸²æŸ“å¼•æ“ï¼Œæä¾› Canvasã€SVGâ€¦","html":"<p>åˆ©ç”¨é˜¿é‡ŒAntviså‡ºå“çš„Gåº•å±‚å›¾å½¢æ¸²æŸ“å™¨ï¼Œç»“åˆAudioContextæä¾›çš„éŸ³é¢‘æ•°æ®è·å–APIï¼Œå®ç°å‡ºç±»ä¼¼ç½‘æ˜“äº‘æ’­æ”¾éŸ³é¢‘ç‰¹æ•ˆã€‚</p>\n<p>é¡¹ç›®åœ°å€ï¼š</p>\n<ul>\n<li><a href=\"https://github.com/leon-kfd/g-music-visualizer\" target=\"_blank\">âš¡Github</a></li>\n<li><a href=\"https://leon-kfd.github.io/g-music-visualizer/\" target=\"_blank\">ğŸ’¡Demo</a></li>\n</ul>\n<h2 id=\"å…³äºgæ¸²æŸ“å™¨\" style=\"position:relative;\"><a href=\"#%E5%85%B3%E4%BA%8Eg%E6%B8%B2%E6%9F%93%E5%99%A8\" aria-label=\"å…³äºgæ¸²æŸ“å™¨ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>å…³äºGæ¸²æŸ“å™¨</h2>\n<p><code class=\"language-text\">G</code>æ˜¯ä¸€æ¬¾æ˜“ç”¨ã€é«˜æ•ˆã€å¼ºå¤§çš„ 2D å¯è§†åŒ–æ¸²æŸ“å¼•æ“ï¼Œæä¾› Canvasã€SVG ç­‰å¤šç§æ¸²æŸ“æ–¹å¼çš„å®ç°ã€‚ç›®å‰ï¼Œå·²æœ‰å¤šä¸ªé¡¶çº§çš„å¯è§†åŒ–å¼€æºé¡¹ç›®åŸºäº<code class=\"language-text\">G</code>å¼€å‘ï¼Œæ¯”å¦‚å›¾å½¢è¯­æ³•åº“<code class=\"language-text\">G2</code>ã€å›¾å¯è§†åŒ–åº“<code class=\"language-text\">G6</code>ç­‰ã€‚</p>\n<p>ä½œä¸ºä¸€ä¸ªåº•å±‚æ¸²æŸ“å™¨ï¼Œå…¶å†…ç½®äº†è®¸å¤šå¸¸ç”¨çš„å†…ç½®å›¾å½¢ï¼Œæä¾›å®Œæ•´çš„DOMäº‹ä»¶æ¨¡æ‹Ÿï¼ŒåŒæ—¶æä¾›äº†æµç¨‹çš„åŠ¨ç”»å®ç°ï¼Œè¿™äº›ç‰¹æ€§å¯¹æˆ‘ä»¬è¿™æ¬¡å®ç°éŸ³é¢‘ç‰¹æ•ˆéƒ½æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</p>\n<p>ç›®å‰ä¸<code class=\"language-text\">G</code>ç›¸ä¼¼çš„ç«å“è¿˜æœ‰<code class=\"language-text\">Echart</code>çš„<code class=\"language-text\">ZRender</code>ï¼Œç›¸æ¯”è¾ƒä»¥æˆ‘ä¸ªäººçœ‹æ³•æ¥è¯´ï¼ŒZrenderæä¾›çš„APIæ›´ä¸°å¯Œï¼Œä½†æ˜¯ä¸Šæ‰‹éš¾åº¦æ¯”Gè¦é«˜ä¸€ç‚¹ï¼Œè€Œ<code class=\"language-text\">G</code>çš„APIç›¸å¯¹<code class=\"language-text\">ç®€æ´</code>ä¸€ç‚¹ã€‚</p>\n<p>ç±»ä¼¼çš„è¿˜æœ‰è€å¤§å“¥<code class=\"language-text\">d3</code>ï¼Œè¿™ä¸ªç›¸è¾ƒä»¥ä¸Šä¸¤ä¸ªæ›´åº•å±‚ï¼ŒAPIæ›´ä¸°å¯Œï¼Œä½†ä¸Šæ‰‹éš¾åº¦å°±æ›´å¤§äº†ã€‚åŒæ—¶<code class=\"language-text\">g</code>é‡Œé¢çš„ä¸€äº›æ–¹æ³•å¥½åƒä¹Ÿæ˜¯å‚è€ƒäº†<code class=\"language-text\">d3</code>ç®—æ³•æ€è·¯ã€‚</p>\n<p><a href=\"https://g.antv.vision/zh/docs/api/canvas\">Gå®˜æ–¹æ–‡æ¡£</a> <em>ï¼ˆè¿™é‡Œåæ§½è¯´ä¸€ä¸‹ï¼ŒGçš„å®˜æ–¹æ–‡æ¡£æ„Ÿè§‰è¿˜æœ‰å¾ˆå¤§ä¼˜åŒ–ç©ºé—´ï¼Œå®åœ¨å¤ªç®€æ´äº†ï¼Œå¾ˆå¤šAPIéƒ½æ˜¯ä¸€ç¬”å¸¦è¿‡ï¼Œç”¨æ³•ä¹Ÿä¸æ€ä¹ˆè¯´æ˜ï¼‰</em></p>\n<h2 id=\"audiocontextè¯»å–éŸ³é¢‘æ•°æ®\" style=\"position:relative;\"><a href=\"#audiocontext%E8%AF%BB%E5%8F%96%E9%9F%B3%E9%A2%91%E6%95%B0%E6%8D%AE\" aria-label=\"audiocontextè¯»å–éŸ³é¢‘æ•°æ® permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AudioContextè¯»å–éŸ³é¢‘æ•°æ®</h2>\n<p>å®ç°éŸ³é¢‘ç‰¹æ•ˆåŠ¨ç”»çš„å‰ææ˜¯éœ€è¦æ‹¿åˆ°ä¸€ä¸ªéŸ³é¢‘çš„éŸ³é¢‘æ•°æ®ï¼Œæµè§ˆç½‘ä¸Šä¸€äº›æ–¹æ¡ˆåï¼Œå‘ç°<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/AudioContext\">AudioContext</a>å«æœ‰ç›¸å…³çš„APIã€‚</p>\n<p>åŸç†ï¼š</p>\n<ul>\n<li>é¦–å…ˆéœ€è¦åŸºäº<code class=\"language-text\">AudioContext.createAnalyser()</code>åˆ›å»ºä¸€ä¸ª<code class=\"language-text\">Analyser</code></li>\n<li>\n<p>ä¸º<code class=\"language-text\">Analyser</code>å…³è”éŸ³é¢‘æºï¼Œç›®å‰å¸¸ç”¨çš„éŸ³é¢‘æºæ–¹å¼ä¸€èˆ¬ä¸ºä»¥ä¸‹ä¸¤ä¸ª</p>\n<ul>\n<li><code class=\"language-text\">AudioContext.createMediaElementSource()</code>: å…³è”åˆ°<code class=\"language-text\">audio</code>æˆ–<code class=\"language-text\">video</code>æ ‡ç­¾ä¸­ï¼ˆå½“å‰æ–¹æ¡ˆé€‰æ‹©äº†è¿™ä¸ªï¼‰</li>\n<li><code class=\"language-text\">AudioContext.createMediaStreamSource()</code>: å…³è”åˆ°æœ¬åœ°è®¡ç®—æœºæˆ–ç½‘ç»œéŸ³é¢‘åª’ä½“æµå¯¹è±¡</li>\n</ul>\n</li>\n<li>åˆ›å»º<code class=\"language-text\">Gain</code>éŸ³é‡èŠ‚ç‚¹å¹¶å…³è”åˆ°<code class=\"language-text\">Analyser</code>çš„<code class=\"language-text\">destination</code>ä¸­</li>\n<li>é€šè¿‡<code class=\"language-text\">AnalyserNode.getByteFrequencyData()</code>æ–¹æ³•å°†å½“å‰é¢‘ç‡æ•°æ®å¤åˆ¶åˆ°ä¼ å…¥çš„æœ€ç»ˆéœ€è¯»å–éŸ³é¢‘çš„Uint8Arrayä¸­</li>\n</ul>\n<p>æŠŠä»¥ä¸Šæ“ä½œå°è£…åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œä¾¿äºåˆå§‹åŒ–ï¼Œå¯å‚è€ƒä»¥ä¸‹ä»£ç :</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// src/plugins/MusicVisualizer.ts</span>\n<span class=\"token keyword\">const</span> _analyser <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">window</span><span class=\"token punctuation\">.</span><span class=\"token function\">AudioContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">MusicVisualizerOptions</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\taudioEl<span class=\"token operator\">?</span><span class=\"token operator\">:</span> HTMLAudioElement<span class=\"token punctuation\">;</span>\n\tsize<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MusicVisualizer</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> analyser<span class=\"token operator\">:</span> AnalyserNode<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> gainNode<span class=\"token operator\">:</span> GainNode<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> audioSource<span class=\"token operator\">?</span><span class=\"token operator\">:</span> MediaElementAudioSourceNode<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> options<span class=\"token operator\">:</span> MusicVisualizerOptions <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">{</span>\n\t\tsize<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> visualArr<span class=\"token operator\">:</span> Uint8Array<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">constructor</span> <span class=\"token punctuation\">(</span>options<span class=\"token operator\">?</span><span class=\"token operator\">:</span> MusicVisualizerOptions<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">const</span> defaultOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t\t\tsize<span class=\"token operator\">:</span> <span class=\"token number\">128</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token operator\">...</span>defaultOptions<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token operator\">...</span>options\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser <span class=\"token operator\">=</span> _analyser<span class=\"token punctuation\">.</span><span class=\"token function\">createAnalyser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">.</span>fftSize <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span>size <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gainNode <span class=\"token operator\">=</span> _analyser<span class=\"token punctuation\">.</span><span class=\"token function\">createGain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gainNode<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>_analyser<span class=\"token punctuation\">.</span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gainNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span>audioEl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioSource <span class=\"token operator\">=</span> _analyser<span class=\"token punctuation\">.</span><span class=\"token function\">createMediaElementSource</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span>audioEl<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioSource<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>visualArr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">.</span>frequencyBinCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">resumeAudioContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// æ–°ç‰ˆChrome Audioéœ€è¦æœ‰äº¤äº’è¡Œä¸ºåæ‰å¯ä»¥åˆ©ç”¨JSæ‰§è¡Œæ’­æ”¾</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token function\">resumeAudioContext</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_analyser<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">resumeAudio</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_analyser<span class=\"token punctuation\">.</span>state <span class=\"token operator\">===</span> <span class=\"token string\">'suspended'</span><span class=\"token punctuation\">)</span> _analyser<span class=\"token punctuation\">.</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\tdocument<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> resumeAudio<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\tdocument<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> resumeAudio<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// æ›´æ¢Audio</span>\n  <span class=\"token function\">setAudioEl</span><span class=\"token punctuation\">(</span>el<span class=\"token operator\">:</span> HTMLAudioElement<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioSource<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioSource<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioSource <span class=\"token operator\">=</span> _analyser<span class=\"token punctuation\">.</span><span class=\"token function\">createMediaElementSource</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioSource<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// è·å–éŸ³é¢‘é¢‘åŸŸæ•°æ®</span>\n\t<span class=\"token function\">getVisualizeValue</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">.</span><span class=\"token function\">getByteFrequencyData</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>visualArr<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>visualArr<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token comment\">// æ›´æ”¹éŸ³é‡</span>\n\t<span class=\"token function\">changeVolumn</span> <span class=\"token punctuation\">(</span>value<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gainNode<span class=\"token punctuation\">.</span>gain<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> value\n\t<span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// å¸è½½</span>\n\t<span class=\"token function\">destory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gainNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioSource<span class=\"token operator\">?.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gainNode<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span>_analyser<span class=\"token punctuation\">.</span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>åˆå§‹åŒ–ä¹‹åï¼Œå°±å¯ä»¥ç›‘å¬Audioçš„æ’­æ”¾äº‹ä»¶ï¼Œå½“æ’­æ”¾æ—¶åˆ©ç”¨<code class=\"language-text\">getVisualizeValue()</code>æ–¹æ³•è·å–åˆ°å®æ—¶éŸ³é¢‘ï¼ˆå¯ç»“åˆåˆ©ç”¨requestAnimationFrameæˆ–setTimeoutè·å–ï¼‰ï¼Œè¿™é‡Œå› ä¸ºæ˜¯åšå¯è§†åŒ–åŠ¨ç”»ï¼Œå½“ç„¶æ˜¯åˆ©ç”¨<code class=\"language-text\">requestAnimationFrame</code>è¯»å–æ¯å¸§çš„æ•°æ®åæ¸²æŸ“ã€‚</p>\n<p>è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼Œå½“Audioçš„æ•°æ®æºæ˜¯ç½‘ç»œéŸ³é¢‘æ—¶ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°æ— æ³•è¯»å–åˆ°éŸ³é¢‘æ•°æ®çš„é—®é¢˜ã€‚è¿™ä¸ªé—®é¢˜ä¸€èˆ¬å¯èƒ½æ˜¯å› ä¸ºç½‘ç»œéŸ³é¢‘çš„è·¨åŸŸé™åˆ¶ï¼Œéœ€è¦ä¸ºAudioæ ‡ç­¾åŠ å…¥<code class=\"language-text\">crossOrigin=\"anonymous\"</code>å±æ€§ã€‚\nä¸€èˆ¬çš„CDNèµ„æºæ˜¯å¾ˆå°‘è®¾ç½®AccessHeaderè·¨åŸŸé™åˆ¶çš„ï¼Œä½†åŠ å…¥è¿™ä¸ªå±æ€§åä»ç„¶å‡ºç°äº†è·¨åŸŸçš„æŠ¥é”™ï¼Œè¯´æ˜è¿™ç½‘ç»œè·¯å¾„æ˜¯è®¾ç½®äº†è·¨åŸŸé™åˆ¶çš„ï¼Œè¿™æ—¶å€™å¯ä»¥è€ƒè™‘ç”¨Nginxåå‘ä»£ç†æˆ–æœåŠ¡ç«¯è§£å†³ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>audio</span> <span class=\"token attr-name\">controls</span> <span class=\"token attr-name\">onPlay</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>{play}</span> <span class=\"token attr-name\">onPause</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>{pause}</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>{audio}</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>{audioURL}</span> <span class=\"token attr-name\">crossOrigin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>anonymous<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>audio</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h2 id=\"å¯è§†åŒ–ç‰¹æ•ˆå®ç°\" style=\"position:relative;\"><a href=\"#%E5%8F%AF%E8%A7%86%E5%8C%96%E7%89%B9%E6%95%88%E5%AE%9E%E7%8E%B0\" aria-label=\"å¯è§†åŒ–ç‰¹æ•ˆå®ç° permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>å¯è§†åŒ–ç‰¹æ•ˆå®ç°</h2>\n<p><strong>ä»¥ä¸‹é€‰å–é¡¹ç›®éƒ¨åˆ†åŠŸèƒ½çš„å®ç°åŸç†è¿›è¡Œè¯´æ˜</strong></p>\n<h3 id=\"ä¸“è¾‘å›¾ç‰‡æ—‹è½¬åŠ¨ç”»\" style=\"position:relative;\"><a href=\"#%E4%B8%93%E8%BE%91%E5%9B%BE%E7%89%87%E6%97%8B%E8%BD%AC%E5%8A%A8%E7%94%BB\" aria-label=\"ä¸“è¾‘å›¾ç‰‡æ—‹è½¬åŠ¨ç”» permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ä¸“è¾‘å›¾ç‰‡æ—‹è½¬åŠ¨ç”»</h3>\n<p>å› ä¸ºæ¯ä¸ªç¤ºä¾‹éƒ½éœ€è¦ç”¨åˆ°ä¸“è¾‘å›¾ç‰‡æ—‹è½¬åŠ¨ç”»ï¼Œå› æ­¤ä¸ºäº†æ–¹ä¾¿æŠŠä¸“è¾‘å›¾ç‰‡çš„åˆ›å»ºæŠ½ç¦»äº†å‡ºæ¥ã€‚</p>\n<p>åœ¨Gä¸­ç”»ä¸€ä¸ªåœ†å½¢å›¾ç‰‡éœ€è¦ç”¨åˆ°<code class=\"language-text\">Clip</code>ï¼Œè¿™ä¸ªåœ¨æ–‡æ¡£ä¸­å¹¶æ²¡æœ‰è¯´æ˜ï¼Œä½†ä»githubä¸­æ‰¾åˆ°äº†è¯¥ç”¨æ³•ã€‚</p>\n<p>æ—‹è½¬åŠ¨ç”»ä¸èƒ½ç›´æ¥ä½¿ç”¨åŸºç¡€å±æ€§æ¨¡æ‹Ÿï¼Œè¿™é‡Œç”¨åˆ°äº†çŸ©é˜µå˜æ¢ï¼Œåˆ©ç”¨<code class=\"language-text\">shape.getMatrix()</code>è·å–åˆå§‹çŸ©é˜µï¼Œå†é€šè¿‡<code class=\"language-text\">transform</code>è®¡ç®—å‡ºæ¯ä¸ª<code class=\"language-text\">ratio</code>å¯¹åº”çš„çŸ©é˜µã€‚</p>\n<p><code class=\"language-text\">transform</code>æ˜¯Gæä¾›çš„ä¸€ä¸ªæ‰©å±•çŸ©é˜µå˜æ¢æ–¹æ³•ï¼Œæ¥æ”¶2ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å½“å‰çŸ©é˜µï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯Actionæ•°ç»„ã€‚è¿™é‡Œçš„æ—‹è½¬å¯¹åº”çš„actionæ˜¯:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">['t', -x, -y],\n['r', æ—‹è½¬è§’åº¦],\n['t', x, y],</code></pre></div>\n<p><img src=\"/blog/616ab3785ecbad63612e224e78cec9c8/play.gif\" alt=\"ç®€å•ç¤ºä¾‹\"></p>\n<p>ä»£ç å‚è€ƒå¦‚ä¸‹:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Canvas <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@antv/g-canvas\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ext <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@antv/matrix-util'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> transform <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> ext <span class=\"token comment\">// Gæä¾›çš„çŸ©é˜µå˜æ¢å¿«æ·æ–¹æ³•</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ImageCircleConfig</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  x<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  y<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  r<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  shadowColor<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getImageCircle</span><span class=\"token punctuation\">(</span>canvas<span class=\"token operator\">:</span> Canvas<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">,</span> shadowColor <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> ImageCircleConfig<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> shadowConfig <span class=\"token operator\">=</span> shadowColor <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n    shadowColor<span class=\"token punctuation\">,</span>\n    shadowBlur<span class=\"token operator\">:</span> <span class=\"token number\">16</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  canvas<span class=\"token punctuation\">.</span><span class=\"token function\">addShape</span><span class=\"token punctuation\">(</span><span class=\"token string\">'circle'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    attrs<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      x<span class=\"token punctuation\">,</span>\n      y<span class=\"token punctuation\">,</span>\n      r<span class=\"token punctuation\">,</span>\n      fill<span class=\"token operator\">:</span> <span class=\"token string\">'#262626'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token operator\">...</span>shadowConfig\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> shape <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">addShape</span><span class=\"token punctuation\">(</span><span class=\"token string\">'image'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    attrs<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      x<span class=\"token operator\">:</span> x <span class=\"token operator\">-</span> r<span class=\"token punctuation\">,</span>\n      y<span class=\"token operator\">:</span> y <span class=\"token operator\">-</span> r<span class=\"token punctuation\">,</span>\n      width<span class=\"token operator\">:</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> r<span class=\"token punctuation\">,</span>\n      height<span class=\"token operator\">:</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> r<span class=\"token punctuation\">,</span>\n      img<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://source.unsplash.com/random/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> r<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">x</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> r<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">?Nature</span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  shape<span class=\"token punctuation\">.</span><span class=\"token function\">setClip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    type<span class=\"token operator\">:</span> <span class=\"token string\">'circle'</span><span class=\"token punctuation\">,</span>\n    attrs<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      x<span class=\"token punctuation\">,</span>\n      y<span class=\"token punctuation\">,</span>\n      r\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// æ—‹è½¬åŠ¨ç”»</span>\n  <span class=\"token keyword\">const</span> matrix <span class=\"token operator\">=</span> shape<span class=\"token punctuation\">.</span><span class=\"token function\">getMatrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> radian <span class=\"token operator\">=</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token comment\">// æ—‹è½¬360åº¦</span>\n  shape<span class=\"token punctuation\">.</span><span class=\"token function\">animate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ratio<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      matrix<span class=\"token operator\">:</span> <span class=\"token function\">transform</span><span class=\"token punctuation\">(</span>matrix<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">'t'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span>x<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">'r'</span><span class=\"token punctuation\">,</span> radian <span class=\"token operator\">*</span> ratio<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">'t'</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    duration<span class=\"token operator\">:</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">,</span>\n    repeat<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\">// åˆ›å»ºåå…ˆæš‚åœåŠ¨ç”»ï¼Œç­‰å¾…æ’­æ”¾åå†æ¢å¤</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    shape<span class=\"token punctuation\">.</span><span class=\"token function\">pauseAnimate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> shape\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"åœ¨åœ†ä¸Šçš„ç‚¹\" style=\"position:relative;\"><a href=\"#%E5%9C%A8%E5%9C%86%E4%B8%8A%E7%9A%84%E7%82%B9\" aria-label=\"åœ¨åœ†ä¸Šçš„ç‚¹ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>åœ¨åœ†ä¸Šçš„ç‚¹</h3>\n<p>ç¤ºä¾‹ä¸­ç»å¸¸è¦è®¡ç®—çš„å°±æ˜¯åœ¨åœ†ä¸Šçš„ç‚¹ï¼Œä»¥æŸ±çŠ¶æ¡ç‰¹æ•ˆï¼ˆç¤ºä¾‹ä¸€ï¼‰ä¸ºä¾‹ï¼Œé¦–å…ˆå°±æ˜¯è¦å‡ºå›´ç»•ç€åœ†çš„å¹³å‡64ä¸ªç‚¹ä½œä¸ºåˆå§‹åæ ‡ã€‚</p>\n<p>å¯é€šè¿‡åˆ©ç”¨å½“å‰ç‚¹ä¸åœ†å¿ƒçš„å¤¹è§’ç»“åˆç®€å•ä¸‰è§’å‡½æ•°è¿ç®—å‡ºx,yçš„åç§»é‡ã€‚</p>\n<p>å¦‚ä¸‹å›¾, <strong>l = cos(Î¸) * r</strong>, <strong>t = sin(Î¸) * r</strong>, é€šè¿‡åœ†å¿ƒOåæ ‡åŠ ä¸Šåç§»é‡å³å¯ç®—å‡ºç‚¹Aåæ ‡ã€‚</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 473px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAd+LQwD/xAAXEAEAAwAAAAAAAAAAAAAAAAABABEg/9oACAEBAAEFAotZ/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRAAAwADAAAAAAAAAAAAAAAAAAEQEVFh/9oACAEBAAE/IWbEZjin/9oADAMBAAIAAwAAABBDz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAAIDAAMAAAAAAAAAAAAAAAERABAxIVFx/9oACAEBAAE/ECWaZiQno0D9hfhD2v/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"è·å–åœ†ä¸Šçš„ç‚¹\"\n        title=\"è·å–åœ†ä¸Šçš„ç‚¹\"\n        src=\"/blog/static/610120a7647305fa8fe646b96cabfa96/1df45/deg.jpg\"\n        srcset=\"/blog/static/610120a7647305fa8fe646b96cabfa96/0cdb7/deg.jpg 300w,\n/blog/static/610120a7647305fa8fe646b96cabfa96/1df45/deg.jpg 473w\"\n        sizes=\"(max-width: 473px) 100vw, 473px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// POINT_NUM = 64 æŸ±çŠ¶æ¡æ•°</span>\nsArr<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> <span class=\"token builtin\">Array</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> length<span class=\"token operator\">:</span> <span class=\"token constant\">POINT_NUM</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> index<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> deg <span class=\"token operator\">=</span> index <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">360</span> <span class=\"token operator\">/</span> <span class=\"token constant\">POINT_NUM</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">150</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å½“å‰è§’åº¦</span>\n\t<span class=\"token keyword\">const</span> l <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>deg <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>  \t\t <span class=\"token comment\">// xæ–¹å‘åç§»ç³»æ•°</span>\n\t<span class=\"token keyword\">const</span> t <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>deg <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>      <span class=\"token comment\">// yæ–¹å‘åç§»ç³»æ•°</span>\n\t<span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> <span class=\"token constant\">R</span> <span class=\"token operator\">+</span> <span class=\"token constant\">OFFSET</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">.</span>current <span class=\"token keyword\">as</span> Canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addShape</span><span class=\"token punctuation\">(</span><span class=\"token string\">'rect'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n\t\tattrs<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\twidth<span class=\"token operator\">:</span> <span class=\"token constant\">RECT_WIDTH</span><span class=\"token punctuation\">,</span>\n\t\t\theight<span class=\"token operator\">:</span> <span class=\"token constant\">RECT_WIDTH</span><span class=\"token punctuation\">,</span>\n\t\t\tradius<span class=\"token operator\">:</span> <span class=\"token constant\">RECT_WIDTH</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n\t\t\tx<span class=\"token operator\">:</span> <span class=\"token constant\">X</span> <span class=\"token operator\">+</span> l <span class=\"token operator\">*</span> r <span class=\"token operator\">-</span> <span class=\"token constant\">RECT_WIDTH</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n\t\t\ty<span class=\"token operator\">:</span> <span class=\"token constant\">Y</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> r <span class=\"token operator\">-</span> <span class=\"token constant\">RECT_WIDTH</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n\t\t\tfill<span class=\"token operator\">:</span> <span class=\"token constant\">RECT_COLOR</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">rotateAtPoint</span><span class=\"token punctuation\">(</span><span class=\"token constant\">X</span> <span class=\"token operator\">+</span> l <span class=\"token operator\">*</span> r<span class=\"token punctuation\">,</span> <span class=\"token constant\">Y</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> r<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>deg <span class=\"token operator\">-</span> <span class=\"token number\">90</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>è¿™é‡Œæ¯ä¸ªæŸ±çŠ¶æ¡éƒ½éœ€è¦è¿›è¡Œæ—‹è½¬æ¥å›´ç»•åœ†æ’åˆ—ï¼Œä½¿ç”¨çš„æ˜¯<code class=\"language-text\">rotateAtPoint</code>ç»•ç€åˆå§‹ç‚¹æ—‹è½¬å¯¹åº”è§’åº¦ã€‚</p>\n<p>åŸºæœ¬æ‰€æœ‰çš„ç¤ºä¾‹éƒ½éœ€è¦é¦–å…ˆè®¡ç®—å‡ºå›´ç»•åœ†çš„ç‚¹åæ ‡ï¼Œéƒ½æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼è®¡ç®—å³å¯ã€‚</p>\n<h3 id=\"ä½¿ç”¨pathç»˜åˆ¶åœ†å½¢\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E7%94%A8path%E7%BB%98%E5%88%B6%E5%9C%86%E5%BD%A2\" aria-label=\"ä½¿ç”¨pathç»˜åˆ¶åœ†å½¢ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ä½¿ç”¨Pathç»˜åˆ¶åœ†å½¢</h3>\n<p>æŸäº›åœºæ™¯ä¸‹éœ€å®ç°ä¸€äº›ç±»åœ†åŠ¨ç”»ï¼ˆç¤ºä¾‹äºŒã€ä¸‰ç­‰ï¼‰ï¼Œä½†åœ†å½¢æ˜¯æ— æ³•å®ç°è¿™ç§åŠ¨ç”»çš„ï¼Œè¿™æ—¶å€™å¯ä»¥é‡‡ç”¨Pathå®ç°ã€‚</p>\n<p>åœ¨åˆå§‹çŠ¶æ€æœªè¿›è¡Œæ’­æ”¾æ—¶ï¼Œé»˜è®¤ä¼šæ˜¾ç¤ºä¸€ä¸ªåœ†å½¢ï¼Œè¿™æ˜¯ä¸ºäº†å‡å°‘åˆ›å»ºä¸€ä¸ªåœ†çš„å®ä¾‹ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨Pathç»˜åˆ¶å‡ºåœ†å½¢ï¼Œåç»­çš„åŠ¨ç”»ç›´æ¥æ›´æ”¹è¿™ä¸ªPathå®ä¾‹ã€‚</p>\n<p>å¯ä»¥ä½¿ç”¨2ä¸ªåœ†å¼§ç”Ÿæˆç”Ÿæˆä¸€ä¸ªåœ†å½¢çš„Pathï¼Œ å‚è€ƒä»¥ä¸‹ä»£ç </p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getCirclePath</span><span class=\"token punctuation\">(</span>cx<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> cy<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> r<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">M </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>cx <span class=\"token operator\">-</span> r<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>cy<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n  a </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>r<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>r<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> 0 1, 0 </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>r <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, 0 \n  a </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>r<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>r<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> 0 1, 0 </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token operator\">-</span>r <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, 0</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"é€šè¿‡ç‚¹å½¢æˆå¹³æ»‘æ›²çº¿\" style=\"position:relative;\"><a href=\"#%E9%80%9A%E8%BF%87%E7%82%B9%E5%BD%A2%E6%88%90%E5%B9%B3%E6%BB%91%E6%9B%B2%E7%BA%BF\" aria-label=\"é€šè¿‡ç‚¹å½¢æˆå¹³æ»‘æ›²çº¿ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>é€šè¿‡ç‚¹å½¢æˆå¹³æ»‘æ›²çº¿</h3>\n<p>è‹¥ä»…ä»…æ˜¯å°†ç›®æ ‡ä¸€ç»„ç‚¹è¿æ¥æˆçº¿ï¼Œåœ¨è§†è§‰æ•ˆæœä¸Šä¼šæ˜¾å¾—å¾ˆçªå…€ï¼ŒåŠæ—¶æ”¹æ¢æˆPathæ¥è¿æ¥æˆæ›²çº¿ä¹Ÿæ˜¯ä¸å¤Ÿå¹³æ»‘ã€‚</p>\n<p>è¿™æ—¶å€™å¯ä»¥é‡‡ç”¨æ’å€¼æ³•ä¸ºè¿ç»­ç›®æ ‡ç‚¹å†æ’å…¥ä¸­é—´ç‚¹æ¥ä¸ºPathæ›´åŠ å¹³æ»‘ï¼Œä¸€èˆ¬æ¥è¯´éƒ½æ˜¯é‡‡ç”¨<code class=\"language-text\">ä¸‰æ¬¡æ ·æ¡æ’å€¼</code>ç®—æ³•å®ç°ã€‚</p>\n<p>åœ¨d3ä¸­å†…ç½®äº†å¾ˆå¤šè¿çº¿ç®—æ³•æ–¹æ¡ˆï¼Œå¯ä»¥ç›´æ¥é‡‡ç”¨ã€‚åœ¨æœ¬æ¬¡çš„ç¤ºä¾‹ä¸­ï¼Œé‡åˆ°å¤šä¸ªç‚¹ç”Ÿæˆå¹³æ»‘æ›²çº¿çš„éƒ½æ˜¯é‡‡ç”¨äº†d3çš„<a href=\"https://d3js.org.cn/document/d3-shape/#curves\">curveCardinalClosed</a>ç®—æ³•æ¥ç”ŸæˆPathè·¯å¾„ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// s-path.tsx</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> line<span class=\"token punctuation\">,</span> curveCardinalClosed <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'d3'</span>\n<span class=\"token comment\">// some other code...</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>data<span class=\"token operator\">?.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">const</span> pathArr<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n\t\t<span class=\"token function\">getArray</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span>index<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\tpathArr<span class=\"token punctuation\">[</span>index <span class=\"token operator\">%</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token function\">getPointByIndex</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">,</span> item <span class=\"token operator\">*</span> item <span class=\"token operator\">/</span> <span class=\"token number\">65025</span> <span class=\"token operator\">*</span> <span class=\"token constant\">POINT_OFFSET</span> <span class=\"token operator\">+</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t\tpathArr<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span>index<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token comment\">// ä½¿ç”¨d3çš„curveCardinalClosedä¸ºç›®æ ‡ç‚¹æ•°ç»„æ’å€¼ç”Ÿæˆå¹³æ»‘æ›²çº¿Path</span>\n\t\t\t<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">line</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">x</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>d<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> d<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">y</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>d<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> d<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">curve</span><span class=\"token punctuation\">(</span>curveCardinalClosed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span>\n\t\t\tsPathArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n\tprops<span class=\"token punctuation\">.</span>data\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">d3</code>å…¶ä»–å¹³æ»‘æ›²çº¿ç®—æ³•ç¤ºä¾‹å¯å‚è€ƒç¬”è€…åœ¨å¾ˆä¹…ä»¥å‰å†™çš„Demo: <a href=\"https://kongfandong.cn/blog/d3-mulitpoint-connection/\">Click here</a></p>\n<h3 id=\"ç²’å­ç‰¹æ•ˆçš„å®ç°\" style=\"position:relative;\"><a href=\"#%E7%B2%92%E5%AD%90%E7%89%B9%E6%95%88%E7%9A%84%E5%AE%9E%E7%8E%B0\" aria-label=\"ç²’å­ç‰¹æ•ˆçš„å®ç° permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ç²’å­ç‰¹æ•ˆçš„å®ç°</h3>\n<p>ç¤ºä¾‹å…­æ˜¯ä¸€ä¸ªç²’å­ç‰¹æ•ˆæ•ˆæœï¼Œä¹Ÿæ˜¯å®ç°è¿™ä¹ˆå¤šç¤ºä¾‹ä¸­è€—æ—¶æ¯”è¾ƒå¤šçš„ä¸€ä¸ªï¼Œè¿™é‡Œæ‹¿å‡ºæ¥è¯´ä¸€ä¸‹å®ç°åŸç†ã€‚</p>\n<p>ä¸å…¶ä»–ç¤ºä¾‹ä¸€æ ·åˆå§‹åŒ–æ—¶ï¼Œå…ˆåˆå§‹åŒ–å‡ºä¸“è¾‘åœ†å½¢å›¾ã€‚</p>\n<p>ç„¶åå‡†å¤‡åˆå§‹åŒ–ç²’å­ï¼Œå®šä¹‰åœ†å½¢ä½œä¸ºç²’å­å½¢çŠ¶ï¼Œå°½é‡å°ä¸€ç‚¹ï¼Œå¯ä»¥å¼€å¯é˜´å½±æ•ˆæœï¼Œä½†æ˜¯æ€§èƒ½ä¼šå¾ˆå·®ï¼Œè¿™æ¬¡å°±æŠŠShadowé˜´å½±å…³é—­äº†ã€‚</p>\n<p>å®šä¹‰æ¯ä¸ªå–æ ·ç‚¹å‘¨å›´çš„ç²’å­æ•°ï¼Œå½“å‰ä¸º64ä¸ªéŸ³é¢‘æ ·ç‚¹ï¼Œä¸€ä¸ªæ ·ç‚¹è®¾ç½®12ä¸ªç²’å­ï¼ˆå¯ä»¥æ›´å¤šï¼ŒåŒæ ·è¶Šå¤šå°±çº¦è€—èƒ½ï¼‰ï¼Œæœ€ç»ˆç²’å­æ•°ä¸º64 X 12ä¸ªã€‚</p>\n<p>ä½¿ç”¨éšæœºå€¼ç”Ÿæˆç²’å­æ ·ç‚¹ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨æ ·ç‚¹å½“å‰è§’åº¦å†éšæœºåç§»ä¸€å®šé‡å³å¯ç”Ÿæˆå‡åŒ€çš„ç²’å­ã€‚</p>\n<p>ç²’å­æ•ˆæœçš„æ¯”è¾ƒéš¾çš„åœ¨äºåŠ¨ç”»ä¸Šï¼Œè¦é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æ¼‚æµ®åŠ¨ç”»å‡½æ•°ã€‚è¿™æ¬¡ç¤ºä¾‹é€‰æ‹©äº†<code class=\"language-text\">æ­£å¼¦å‡½æ•°</code>å®ç°å·¦å³å‡åŒ€æ¼‚æµ®ï¼Œåœ¨åŠ ä¸Šåˆ©ç”¨<code class=\"language-text\">setTimeout</code>éšæœºå»¶è¿Ÿç²’å­ç”Ÿæˆæ—¶é—´å³å¯å®Œæˆç²’å­æŒ‰ä¸€å®šè§„å¾‹ä¸‹æ¼‚æµ®çš„åŠ¨ç”»ã€‚</p>\n<p>å®šä¹‰ç²’å­åŠ¨ç”»æ—¶ï¼Œé€šè¿‡æ­£å¼¦å‡½æ•°ä¸ratioè®¡ç®—å‡ºæ¯å¸§ç²’å­çš„å®é™…x,yåæ ‡å³å¯ã€‚å› ä¸ºè¿™æ¬¡è¿˜ä¼šç»“åˆå½“å‰éŸ³é¢‘æ•°æ®ï¼Œè®©æŸä¸ªæ ·ç‚¹çš„ç²’å­é£˜å¾—é«˜ä¸€ç‚¹ï¼Œè®©ç²’å­çš„åç§»é‡åŠ å¤§ï¼Œè¿™æ—¶è¿˜éœ€è¦è¿›ä¸€æ­¥å¯¹åŠ¨ç”»è¿›è¡Œæ›´æ”¹ã€‚</p>\n<p><img src=\"/blog/cb8e5d647e0a4441d6462280f3a5cad3/particle.gif\" alt=\"ç²’å­ç‰¹æ•ˆ\"></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// POINT_NUM = 64 æ ·ç‚¹æ•°</span>\n<span class=\"token comment\">// PARTICLE_NUM = 12 æ ·ç‚¹å‘¨å›´ç²’å­æ•°</span>\n<span class=\"token builtin\">Array</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> length<span class=\"token operator\">:</span> <span class=\"token constant\">POINT_NUM</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>point<span class=\"token punctuation\">,</span> index1<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token builtin\">Array</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> length<span class=\"token operator\">:</span> <span class=\"token constant\">PARTICLE_NUM</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>particle<span class=\"token punctuation\">,</span> index2<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">const</span> deg <span class=\"token operator\">=</span> index1 <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">360</span> <span class=\"token operator\">/</span> <span class=\"token constant\">POINT_NUM</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">150</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">const</span> l <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>deg <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">const</span> t <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>deg <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> <span class=\"token constant\">R</span> <span class=\"token operator\">+</span> <span class=\"token constant\">OFFSET</span>\n\t\t<span class=\"token keyword\">const</span> x <span class=\"token operator\">=</span> <span class=\"token constant\">X</span> <span class=\"token operator\">+</span> l <span class=\"token operator\">*</span> r\n\t\t<span class=\"token keyword\">const</span> y <span class=\"token operator\">=</span> <span class=\"token constant\">Y</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> r\n\t\t<span class=\"token keyword\">const</span> particleShape <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">.</span>current <span class=\"token keyword\">as</span> Canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addShape</span><span class=\"token punctuation\">(</span><span class=\"token string\">'circle'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n\t\t\tattrs<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tx<span class=\"token punctuation\">,</span>\n\t\t\t\ty<span class=\"token punctuation\">,</span>\n\t\t\t\tr<span class=\"token operator\">:</span> <span class=\"token number\">0.8</span><span class=\"token punctuation\">,</span>\n\t\t\t\tfill<span class=\"token operator\">:</span> <span class=\"token string\">'#fff'</span><span class=\"token punctuation\">,</span>\n\t\t\t\topacity<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token comment\">// âš å¼€å¯é˜´å½±ä¼šæ‰å¸§</span>\n\t\t\t\t<span class=\"token comment\">// shadowColor: '#fcc8d9',</span>\n\t\t\t\t<span class=\"token comment\">// shadowBlur: 1</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t\tparticleShape<span class=\"token punctuation\">.</span><span class=\"token function\">animate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ratio<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">const</span> deg <span class=\"token operator\">=</span> index1 <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">360</span> <span class=\"token operator\">/</span> <span class=\"token constant\">POINT_NUM</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">150</span> <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>ratio <span class=\"token operator\">*</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">const</span> l <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>deg <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">const</span> t <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>deg <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">const</span> _index <span class=\"token operator\">=</span> <span class=\"token constant\">POINT_NUM</span> <span class=\"token operator\">*</span> index1 <span class=\"token operator\">+</span> index2\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>particleActiveArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">[</span>_index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ratio <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.02</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\tparticleActiveArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">[</span>_index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> \n\t\t\t\t\t\tindex1 <span class=\"token operator\">>=</span> currentActiveIndex<span class=\"token punctuation\">.</span>current <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> index1 <span class=\"token operator\">&lt;=</span> currentActiveIndex<span class=\"token punctuation\">.</span>current <span class=\"token operator\">+</span> <span class=\"token number\">1</span> \n\t\t\t\t\t\t<span class=\"token operator\">?</span> <span class=\"token constant\">POINT_ACTIVE_MOVE_LENGTH</span> \n\t\t\t\t\t\t<span class=\"token operator\">:</span> <span class=\"token constant\">POINT_MOVE_LENGTH</span>\n\t\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ratio <span class=\"token operator\">></span> <span class=\"token number\">0.98</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\tparticleActiveArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">[</span>_index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token constant\">POINT_MOVE_LENGTH</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">const</span> offset <span class=\"token operator\">=</span> particleActiveArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">[</span>_index<span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token constant\">POINT_MOVE_LENGTH</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tx<span class=\"token operator\">:</span> x <span class=\"token operator\">+</span> l <span class=\"token operator\">*</span> ratio <span class=\"token operator\">*</span> offset<span class=\"token punctuation\">,</span>\n\t\t\t\ty<span class=\"token operator\">:</span> y <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> ratio <span class=\"token operator\">*</span> offset<span class=\"token punctuation\">,</span>\n\t\t\t\topacity<span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token operator\">-</span> ratio\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n\t\t\tduration<span class=\"token operator\">:</span> <span class=\"token constant\">POINT_CREATE_DELAY</span><span class=\"token punctuation\">,</span>\n\t\t\trepeat<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\teasing<span class=\"token operator\">:</span> <span class=\"token string\">'easeSinInOut'</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t\tparticleArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>particleShape<span class=\"token punctuation\">)</span>\n\t\tparticleStartArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n\t\tparticleActiveArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token constant\">POINT_MOVE_LENGTH</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"å…¶ä»–è¯´æ˜\" style=\"position:relative;\"><a href=\"#%E5%85%B6%E4%BB%96%E8%AF%B4%E6%98%8E\" aria-label=\"å…¶ä»–è¯´æ˜ permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>å…¶ä»–è¯´æ˜</h2>\n<p>è¿™ä¸ªé¡¹ç›®æ˜¯ä¸€ä¸ªç»ƒæ‰‹é¡¹ç›®ï¼ŒåŸºäº<code class=\"language-text\">vite</code>ã€<code class=\"language-text\">React</code>ã€<code class=\"language-text\">Typescript</code>ï¼Œå› ä¸ºreactå¹³æ—¶ç”¨çš„ä¸å¤šï¼Œé¡¹ç›®ä¸­å­˜åœ¨ä»€ä¹ˆé—®é¢˜æˆ–å†™çš„ä¸å¥½çš„åœ°æ–¹æ¬¢è¿æŒ‡ç‚¹ã€‚</p>\n<p>æˆ–è€…æœ‰ä»€ä¹ˆå¥½çœ‹çš„ç‰¹æ•ˆä¹Ÿå¯ä»¥æISSUEæˆ–PRäº¤æµä¸€ä¸‹æ€ä¹ˆå®ç°ã€‚</p>\n<p>é¡¹ç›®Github: <a href=\"https://github.com/leon-kfd/g-music-visualizer\" target=\"_blank\"><strong>Click Here</strong></a></p>\n<p>é¡¹ç›®Demo: <a href=\"https://leon-kfd.github.io/g-music-visualizer/\" target=\"_blank\"><strong>Click Here</strong></a></p>","frontmatter":{"title":"åˆ©ç”¨Gæ¸²æŸ“å™¨å®ç°çš„éŸ³é¢‘å¯è§†åŒ–æ–¹æ¡ˆ","date":"June 29, 2021","description":"åˆ©ç”¨é˜¿é‡ŒAntviså‡ºå“çš„Gåº•å±‚å›¾å½¢æ¸²æŸ“å™¨ï¼Œç»“åˆAudioContextæä¾›çš„éŸ³é¢‘æ•°æ®è·å–Apiï¼Œå®ç°å‡ºç±»ä¼¼ç½‘æ˜“äº‘æ’­æ”¾éŸ³é¢‘ç‰¹æ•ˆã€‚"}}},"pageContext":{"slug":"/g-music-visualizer/","previous":{"fields":{"slug":"/mouse-menu-introduction/"},"frontmatter":{"title":"Vue3å®ç°è‡ªå®šä¹‰å³é”®èœå•"}},"next":{"fields":{"slug":"/design-of-howdz/"},"frontmatter":{"title":"Howdzèµ·å§‹é¡µå¼€å‘è®°å½•"}}}},"staticQueryHashes":["143701507","165057280"]}