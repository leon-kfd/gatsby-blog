{"componentChunkName":"component---src-templates-blog-post-js","path":"/g-music-visualizer/","result":{"data":{"site":{"siteMetadata":{"title":"Howdy"}},"markdownRemark":{"id":"44344ac0-ea1e-5763-a8d2-16b45c2372d3","excerpt":"利用阿里Antvis出品的G底层图形渲染器，结合AudioContext提供的音频数据获取API，实现出类似网易云播放音频特效。 项目地址： ⚡Github 💡Demo 关于G渲染器 是一款易用、高效、强大的 2D 可视化渲染引擎，提供 Canvas、SVG…","html":"<p>利用阿里Antvis出品的G底层图形渲染器，结合AudioContext提供的音频数据获取API，实现出类似网易云播放音频特效。</p>\n<p>项目地址：</p>\n<ul>\n<li><a href=\"https://github.com/leon-kfd/g-music-visualizer\" target=\"_blank\">⚡Github</a></li>\n<li><a href=\"https://leon-kfd.github.io/g-music-visualizer/\" target=\"_blank\">💡Demo</a></li>\n</ul>\n<h2 id=\"关于g渲染器\" style=\"position:relative;\"><a href=\"#%E5%85%B3%E4%BA%8Eg%E6%B8%B2%E6%9F%93%E5%99%A8\" aria-label=\"关于g渲染器 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>关于G渲染器</h2>\n<p><code class=\"language-text\">G</code>是一款易用、高效、强大的 2D 可视化渲染引擎，提供 Canvas、SVG 等多种渲染方式的实现。目前，已有多个顶级的可视化开源项目基于<code class=\"language-text\">G</code>开发，比如图形语法库<code class=\"language-text\">G2</code>、图可视化库<code class=\"language-text\">G6</code>等。</p>\n<p>作为一个底层渲染器，其内置了许多常用的内置图形，提供完整的DOM事件模拟，同时提供了流程的动画实现，这些特性对我们这次实现音频特效都是很有必要的。</p>\n<p>目前与<code class=\"language-text\">G</code>相似的竞品还有<code class=\"language-text\">Echart</code>的<code class=\"language-text\">ZRender</code>，相比较以我个人看法来说，Zrender提供的API更丰富，但是上手难度比G要高一点，而<code class=\"language-text\">G</code>的API相对<code class=\"language-text\">简洁</code>一点。</p>\n<p>类似的还有老大哥<code class=\"language-text\">d3</code>，这个相较以上两个更底层，API更丰富，但上手难度就更大了。同时<code class=\"language-text\">g</code>里面的一些方法好像也是参考了<code class=\"language-text\">d3</code>算法思路。</p>\n<p><a href=\"https://g.antv.vision/zh/docs/api/canvas\">G官方文档</a> <em>（这里吐槽说一下，G的官方文档感觉还有很大优化空间，实在太简洁了，很多API都是一笔带过，用法也不怎么说明）</em></p>\n<h2 id=\"audiocontext读取音频数据\" style=\"position:relative;\"><a href=\"#audiocontext%E8%AF%BB%E5%8F%96%E9%9F%B3%E9%A2%91%E6%95%B0%E6%8D%AE\" aria-label=\"audiocontext读取音频数据 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AudioContext读取音频数据</h2>\n<p>实现音频特效动画的前提是需要拿到一个音频的音频数据，浏览网上一些方案后，发现<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/AudioContext\">AudioContext</a>含有相关的API。</p>\n<p>原理：</p>\n<ul>\n<li>首先需要基于<code class=\"language-text\">AudioContext.createAnalyser()</code>创建一个<code class=\"language-text\">Analyser</code></li>\n<li>\n<p>为<code class=\"language-text\">Analyser</code>关联音频源，目前常用的音频源方式一般为以下两个</p>\n<ul>\n<li><code class=\"language-text\">AudioContext.createMediaElementSource()</code>: 关联到<code class=\"language-text\">audio</code>或<code class=\"language-text\">video</code>标签中（当前方案选择了这个）</li>\n<li><code class=\"language-text\">AudioContext.createMediaStreamSource()</code>: 关联到本地计算机或网络音频媒体流对象</li>\n</ul>\n</li>\n<li>创建<code class=\"language-text\">Gain</code>音量节点并关联到<code class=\"language-text\">Analyser</code>的<code class=\"language-text\">destination</code>中</li>\n<li>通过<code class=\"language-text\">AnalyserNode.getByteFrequencyData()</code>方法将当前频率数据复制到传入的最终需读取音频的Uint8Array中</li>\n</ul>\n<p>把以上操作封装到一个类中，便于初始化，可参考以下代码:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// src/plugins/MusicVisualizer.ts</span>\n<span class=\"token keyword\">const</span> _analyser <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">window</span><span class=\"token punctuation\">.</span><span class=\"token function\">AudioContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">MusicVisualizerOptions</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\taudioEl<span class=\"token operator\">?</span><span class=\"token operator\">:</span> HTMLAudioElement<span class=\"token punctuation\">;</span>\n\tsize<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">MusicVisualizer</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> analyser<span class=\"token operator\">:</span> AnalyserNode<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> gainNode<span class=\"token operator\">:</span> GainNode<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> audioSource<span class=\"token operator\">?</span><span class=\"token operator\">:</span> MediaElementAudioSourceNode<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> options<span class=\"token operator\">:</span> MusicVisualizerOptions <span class=\"token operator\">&amp;</span> <span class=\"token punctuation\">{</span>\n\t\tsize<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">private</span> visualArr<span class=\"token operator\">:</span> Uint8Array<span class=\"token punctuation\">;</span>\n\t<span class=\"token function\">constructor</span> <span class=\"token punctuation\">(</span>options<span class=\"token operator\">?</span><span class=\"token operator\">:</span> MusicVisualizerOptions<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">const</span> defaultOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t\t\tsize<span class=\"token operator\">:</span> <span class=\"token number\">128</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token operator\">...</span>defaultOptions<span class=\"token punctuation\">,</span>\n\t\t\t<span class=\"token operator\">...</span>options\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser <span class=\"token operator\">=</span> _analyser<span class=\"token punctuation\">.</span><span class=\"token function\">createAnalyser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">.</span>fftSize <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span>size <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gainNode <span class=\"token operator\">=</span> _analyser<span class=\"token punctuation\">.</span><span class=\"token function\">createGain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gainNode<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>_analyser<span class=\"token punctuation\">.</span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gainNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span>audioEl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioSource <span class=\"token operator\">=</span> _analyser<span class=\"token punctuation\">.</span><span class=\"token function\">createMediaElementSource</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span>audioEl<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioSource<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>visualArr <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Uint8Array</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">.</span>frequencyBinCount<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">resumeAudioContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 新版Chrome Audio需要有交互行为后才可以利用JS执行播放</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token function\">resumeAudioContext</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_analyser<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">resumeAudio</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_analyser<span class=\"token punctuation\">.</span>state <span class=\"token operator\">===</span> <span class=\"token string\">'suspended'</span><span class=\"token punctuation\">)</span> _analyser<span class=\"token punctuation\">.</span><span class=\"token function\">resume</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t\tdocument<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> resumeAudio<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\tdocument<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> resumeAudio<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 更换Audio</span>\n  <span class=\"token function\">setAudioEl</span><span class=\"token punctuation\">(</span>el<span class=\"token operator\">:</span> HTMLAudioElement<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioSource<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioSource<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioSource <span class=\"token operator\">=</span> _analyser<span class=\"token punctuation\">.</span><span class=\"token function\">createMediaElementSource</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioSource<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 获取音频频域数据</span>\n\t<span class=\"token function\">getVisualizeValue</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">.</span><span class=\"token function\">getByteFrequencyData</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>visualArr<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>visualArr<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token comment\">// 更改音量</span>\n\t<span class=\"token function\">changeVolumn</span> <span class=\"token punctuation\">(</span>value<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gainNode<span class=\"token punctuation\">.</span>gain<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> value\n\t<span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// 卸载</span>\n\t<span class=\"token function\">destory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gainNode<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>audioSource<span class=\"token operator\">?.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>analyser<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>gainNode<span class=\"token punctuation\">.</span><span class=\"token function\">disconnect</span><span class=\"token punctuation\">(</span>_analyser<span class=\"token punctuation\">.</span>destination<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>初始化之后，就可以监听Audio的播放事件，当播放时利用<code class=\"language-text\">getVisualizeValue()</code>方法获取到实时音频（可结合利用requestAnimationFrame或setTimeout获取），这里因为是做可视化动画，当然是利用<code class=\"language-text\">requestAnimationFrame</code>读取每帧的数据后渲染。</p>\n<p>还有一个需要注意的点，当Audio的数据源是网络音频时，有可能会出现无法读取到音频数据的问题。这个问题一般可能是因为网络音频的跨域限制，需要为Audio标签加入<code class=\"language-text\">crossOrigin=\"anonymous\"</code>属性。\n一般的CDN资源是很少设置AccessHeader跨域限制的，但加入这个属性后仍然出现了跨域的报错，说明这网络路径是设置了跨域限制的，这时候可以考虑用Nginx反向代理或服务端解决。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>audio</span> <span class=\"token attr-name\">controls</span> <span class=\"token attr-name\">onPlay</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>{play}</span> <span class=\"token attr-name\">onPause</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>{pause}</span> <span class=\"token attr-name\">ref</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>{audio}</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span>{audioURL}</span> <span class=\"token attr-name\">crossOrigin</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>anonymous<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>audio</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h2 id=\"可视化特效实现\" style=\"position:relative;\"><a href=\"#%E5%8F%AF%E8%A7%86%E5%8C%96%E7%89%B9%E6%95%88%E5%AE%9E%E7%8E%B0\" aria-label=\"可视化特效实现 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>可视化特效实现</h2>\n<p><strong>以下选取项目部分功能的实现原理进行说明</strong></p>\n<h3 id=\"专辑图片旋转动画\" style=\"position:relative;\"><a href=\"#%E4%B8%93%E8%BE%91%E5%9B%BE%E7%89%87%E6%97%8B%E8%BD%AC%E5%8A%A8%E7%94%BB\" aria-label=\"专辑图片旋转动画 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>专辑图片旋转动画</h3>\n<p>因为每个示例都需要用到专辑图片旋转动画，因此为了方便把专辑图片的创建抽离了出来。</p>\n<p>在G中画一个圆形图片需要用到<code class=\"language-text\">Clip</code>，这个在文档中并没有说明，但从github中找到了该用法。</p>\n<p>旋转动画不能直接使用基础属性模拟，这里用到了矩阵变换，利用<code class=\"language-text\">shape.getMatrix()</code>获取初始矩阵，再通过<code class=\"language-text\">transform</code>计算出每个<code class=\"language-text\">ratio</code>对应的矩阵。</p>\n<p><code class=\"language-text\">transform</code>是G提供的一个扩展矩阵变换方法，接收2个参数，第一个是当前矩阵，第二个参数是Action数组。这里的旋转对应的action是:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">['t', -x, -y],\n['r', 旋转角度],\n['t', x, y],</code></pre></div>\n<p><img src=\"/blog/616ab3785ecbad63612e224e78cec9c8/play.gif\" alt=\"简单示例\"></p>\n<p>代码参考如下:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Canvas <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@antv/g-canvas\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ext <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@antv/matrix-util'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> transform <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> ext <span class=\"token comment\">// G提供的矩阵变换快捷方法</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">ImageCircleConfig</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  x<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  y<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  r<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  shadowColor<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getImageCircle</span><span class=\"token punctuation\">(</span>canvas<span class=\"token operator\">:</span> Canvas<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">,</span> r<span class=\"token punctuation\">,</span> shadowColor <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> ImageCircleConfig<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> shadowConfig <span class=\"token operator\">=</span> shadowColor <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span>\n    shadowColor<span class=\"token punctuation\">,</span>\n    shadowBlur<span class=\"token operator\">:</span> <span class=\"token number\">16</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n  canvas<span class=\"token punctuation\">.</span><span class=\"token function\">addShape</span><span class=\"token punctuation\">(</span><span class=\"token string\">'circle'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    attrs<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      x<span class=\"token punctuation\">,</span>\n      y<span class=\"token punctuation\">,</span>\n      r<span class=\"token punctuation\">,</span>\n      fill<span class=\"token operator\">:</span> <span class=\"token string\">'#262626'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token operator\">...</span>shadowConfig\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> shape <span class=\"token operator\">=</span> canvas<span class=\"token punctuation\">.</span><span class=\"token function\">addShape</span><span class=\"token punctuation\">(</span><span class=\"token string\">'image'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    attrs<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      x<span class=\"token operator\">:</span> x <span class=\"token operator\">-</span> r<span class=\"token punctuation\">,</span>\n      y<span class=\"token operator\">:</span> y <span class=\"token operator\">-</span> r<span class=\"token punctuation\">,</span>\n      width<span class=\"token operator\">:</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> r<span class=\"token punctuation\">,</span>\n      height<span class=\"token operator\">:</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> r<span class=\"token punctuation\">,</span>\n      img<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://source.unsplash.com/random/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> r<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">x</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token number\">2</span> <span class=\"token operator\">*</span> r<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">?Nature</span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  shape<span class=\"token punctuation\">.</span><span class=\"token function\">setClip</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    type<span class=\"token operator\">:</span> <span class=\"token string\">'circle'</span><span class=\"token punctuation\">,</span>\n    attrs<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      x<span class=\"token punctuation\">,</span>\n      y<span class=\"token punctuation\">,</span>\n      r\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// 旋转动画</span>\n  <span class=\"token keyword\">const</span> matrix <span class=\"token operator\">=</span> shape<span class=\"token punctuation\">.</span><span class=\"token function\">getMatrix</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> radian <span class=\"token operator\">=</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token comment\">// 旋转360度</span>\n  shape<span class=\"token punctuation\">.</span><span class=\"token function\">animate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ratio<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      matrix<span class=\"token operator\">:</span> <span class=\"token function\">transform</span><span class=\"token punctuation\">(</span>matrix<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">'t'</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span>x<span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span>y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">'r'</span><span class=\"token punctuation\">,</span> radian <span class=\"token operator\">*</span> ratio<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span><span class=\"token string\">'t'</span><span class=\"token punctuation\">,</span> x<span class=\"token punctuation\">,</span> y<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    duration<span class=\"token operator\">:</span> <span class=\"token number\">10000</span><span class=\"token punctuation\">,</span>\n    repeat<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\">// 创建后先暂停动画，等待播放后再恢复</span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    shape<span class=\"token punctuation\">.</span><span class=\"token function\">pauseAnimate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> shape\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"在圆上的点\" style=\"position:relative;\"><a href=\"#%E5%9C%A8%E5%9C%86%E4%B8%8A%E7%9A%84%E7%82%B9\" aria-label=\"在圆上的点 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>在圆上的点</h3>\n<p>示例中经常要计算的就是在圆上的点，以柱状条特效（示例一）为例，首先就是要出围绕着圆的平均64个点作为初始坐标。</p>\n<p>可通过利用当前点与圆心的夹角结合简单三角函数运算出x,y的偏移量。</p>\n<p>如下图, <strong>l = cos(θ) * r</strong>, <strong>t = sin(θ) * r</strong>, 通过圆心O坐标加上偏移量即可算出点A坐标。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 473px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAd+LQwD/xAAXEAEAAwAAAAAAAAAAAAAAAAABABEg/9oACAEBAAEFAotZ/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRAAAwADAAAAAAAAAAAAAAAAAAEQEVFh/9oACAEBAAE/IWbEZjin/9oADAMBAAIAAwAAABBDz//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABsQAAIDAAMAAAAAAAAAAAAAAAERABAxIVFx/9oACAEBAAE/ECWaZiQno0D9hfhD2v/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"获取圆上的点\"\n        title=\"获取圆上的点\"\n        src=\"/blog/static/610120a7647305fa8fe646b96cabfa96/1df45/deg.jpg\"\n        srcset=\"/blog/static/610120a7647305fa8fe646b96cabfa96/0cdb7/deg.jpg 300w,\n/blog/static/610120a7647305fa8fe646b96cabfa96/1df45/deg.jpg 473w\"\n        sizes=\"(max-width: 473px) 100vw, 473px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// POINT_NUM = 64 柱状条数</span>\nsArr<span class=\"token punctuation\">.</span>current <span class=\"token operator\">=</span> <span class=\"token builtin\">Array</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> length<span class=\"token operator\">:</span> <span class=\"token constant\">POINT_NUM</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span> index<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> deg <span class=\"token operator\">=</span> index <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">360</span> <span class=\"token operator\">/</span> <span class=\"token constant\">POINT_NUM</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">150</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 当前角度</span>\n\t<span class=\"token keyword\">const</span> l <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>deg <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>  \t\t <span class=\"token comment\">// x方向偏移系数</span>\n\t<span class=\"token keyword\">const</span> t <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>deg <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>      <span class=\"token comment\">// y方向偏移系数</span>\n\t<span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> <span class=\"token constant\">R</span> <span class=\"token operator\">+</span> <span class=\"token constant\">OFFSET</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">.</span>current <span class=\"token keyword\">as</span> Canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addShape</span><span class=\"token punctuation\">(</span><span class=\"token string\">'rect'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n\t\tattrs<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\twidth<span class=\"token operator\">:</span> <span class=\"token constant\">RECT_WIDTH</span><span class=\"token punctuation\">,</span>\n\t\t\theight<span class=\"token operator\">:</span> <span class=\"token constant\">RECT_WIDTH</span><span class=\"token punctuation\">,</span>\n\t\t\tradius<span class=\"token operator\">:</span> <span class=\"token constant\">RECT_WIDTH</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n\t\t\tx<span class=\"token operator\">:</span> <span class=\"token constant\">X</span> <span class=\"token operator\">+</span> l <span class=\"token operator\">*</span> r <span class=\"token operator\">-</span> <span class=\"token constant\">RECT_WIDTH</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n\t\t\ty<span class=\"token operator\">:</span> <span class=\"token constant\">Y</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> r <span class=\"token operator\">-</span> <span class=\"token constant\">RECT_WIDTH</span> <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n\t\t\tfill<span class=\"token operator\">:</span> <span class=\"token constant\">RECT_COLOR</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">rotateAtPoint</span><span class=\"token punctuation\">(</span><span class=\"token constant\">X</span> <span class=\"token operator\">+</span> l <span class=\"token operator\">*</span> r<span class=\"token punctuation\">,</span> <span class=\"token constant\">Y</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> r<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>deg <span class=\"token operator\">-</span> <span class=\"token number\">90</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>这里每个柱状条都需要进行旋转来围绕圆排列，使用的是<code class=\"language-text\">rotateAtPoint</code>绕着初始点旋转对应角度。</p>\n<p>基本所有的示例都需要首先计算出围绕圆的点坐标，都是采用这种方式计算即可。</p>\n<h3 id=\"使用path绘制圆形\" style=\"position:relative;\"><a href=\"#%E4%BD%BF%E7%94%A8path%E7%BB%98%E5%88%B6%E5%9C%86%E5%BD%A2\" aria-label=\"使用path绘制圆形 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用Path绘制圆形</h3>\n<p>某些场景下需实现一些类圆动画（示例二、三等），但圆形是无法实现这种动画的，这时候可以采用Path实现。</p>\n<p>在初始状态未进行播放时，默认会显示一个圆形，这是为了减少创建一个圆的实例，可以直接利用Path绘制出圆形，后续的动画直接更改这个Path实例。</p>\n<p>可以使用2个圆弧生成生成一个圆形的Path， 参考以下代码</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getCirclePath</span><span class=\"token punctuation\">(</span>cx<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> cy<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> r<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">M </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>cx <span class=\"token operator\">-</span> r<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>cy<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n  a </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>r<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>r<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> 0 1, 0 </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>r <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, 0 \n  a </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>r<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>r<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> 0 1, 0 </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token operator\">-</span>r <span class=\"token operator\">*</span> <span class=\"token number\">2</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">, 0</span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"通过点形成平滑曲线\" style=\"position:relative;\"><a href=\"#%E9%80%9A%E8%BF%87%E7%82%B9%E5%BD%A2%E6%88%90%E5%B9%B3%E6%BB%91%E6%9B%B2%E7%BA%BF\" aria-label=\"通过点形成平滑曲线 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>通过点形成平滑曲线</h3>\n<p>若仅仅是将目标一组点连接成线，在视觉效果上会显得很突兀，及时改换成Path来连接成曲线也是不够平滑。</p>\n<p>这时候可以采用插值法为连续目标点再插入中间点来为Path更加平滑，一般来说都是采用<code class=\"language-text\">三次样条插值</code>算法实现。</p>\n<p>在d3中内置了很多连线算法方案，可以直接采用。在本次的示例中，遇到多个点生成平滑曲线的都是采用了d3的<a href=\"https://d3js.org.cn/document/d3-shape/#curves\">curveCardinalClosed</a>算法来生成Path路径。</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// s-path.tsx</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> line<span class=\"token punctuation\">,</span> curveCardinalClosed <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'d3'</span>\n<span class=\"token comment\">// some other code...</span>\n<span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>data<span class=\"token operator\">?.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">const</span> pathArr<span class=\"token operator\">:</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n\t\t<span class=\"token function\">getArray</span><span class=\"token punctuation\">(</span>props<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span>index<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\tpathArr<span class=\"token punctuation\">[</span>index <span class=\"token operator\">%</span> <span class=\"token number\">4</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token function\">getPointByIndex</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">,</span> item <span class=\"token operator\">*</span> item <span class=\"token operator\">/</span> <span class=\"token number\">65025</span> <span class=\"token operator\">*</span> <span class=\"token constant\">POINT_OFFSET</span> <span class=\"token operator\">+</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t\tpathArr<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">,</span>index<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token comment\">// 使用d3的curveCardinalClosed为目标点数组插值生成平滑曲线Path</span>\n\t\t\t<span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">line</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">x</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>d<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> d<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">y</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>d<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> d<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">curve</span><span class=\"token punctuation\">(</span>curveCardinalClosed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span>\n\t\t\tsPathArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">,</span> path<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>\n\tprops<span class=\"token punctuation\">.</span>data\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><code class=\"language-text\">d3</code>其他平滑曲线算法示例可参考笔者在很久以前写的Demo: <a href=\"https://kongfandong.cn/blog/d3-mulitpoint-connection/\">Click here</a></p>\n<h3 id=\"粒子特效的实现\" style=\"position:relative;\"><a href=\"#%E7%B2%92%E5%AD%90%E7%89%B9%E6%95%88%E7%9A%84%E5%AE%9E%E7%8E%B0\" aria-label=\"粒子特效的实现 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>粒子特效的实现</h3>\n<p>示例六是一个粒子特效效果，也是实现这么多示例中耗时比较多的一个，这里拿出来说一下实现原理。</p>\n<p>与其他示例一样初始化时，先初始化出专辑圆形图。</p>\n<p>然后准备初始化粒子，定义圆形作为粒子形状，尽量小一点，可以开启阴影效果，但是性能会很差，这次就把Shadow阴影关闭了。</p>\n<p>定义每个取样点周围的粒子数，当前为64个音频样点，一个样点设置12个粒子（可以更多，同样越多就约耗能），最终粒子数为64 X 12个。</p>\n<p>使用随机值生成粒子样点，这里可以使用样点当前角度再随机偏移一定量即可生成均匀的粒子。</p>\n<p>粒子效果的比较难的在于动画上，要选择一个合适的漂浮动画函数。这次示例选择了<code class=\"language-text\">正弦函数</code>实现左右均匀漂浮，在加上利用<code class=\"language-text\">setTimeout</code>随机延迟粒子生成时间即可完成粒子按一定规律下漂浮的动画。</p>\n<p>定义粒子动画时，通过正弦函数与ratio计算出每帧粒子的实际x,y坐标即可。因为这次还会结合当前音频数据，让某个样点的粒子飘得高一点，让粒子的偏移量加大，这时还需要进一步对动画进行更改。</p>\n<p><img src=\"/blog/cb8e5d647e0a4441d6462280f3a5cad3/particle.gif\" alt=\"粒子特效\"></p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// POINT_NUM = 64 样点数</span>\n<span class=\"token comment\">// PARTICLE_NUM = 12 样点周围粒子数</span>\n<span class=\"token builtin\">Array</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> length<span class=\"token operator\">:</span> <span class=\"token constant\">POINT_NUM</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>point<span class=\"token punctuation\">,</span> index1<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token builtin\">Array</span><span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> length<span class=\"token operator\">:</span> <span class=\"token constant\">PARTICLE_NUM</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>particle<span class=\"token punctuation\">,</span> index2<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">const</span> deg <span class=\"token operator\">=</span> index1 <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">360</span> <span class=\"token operator\">/</span> <span class=\"token constant\">POINT_NUM</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">150</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">const</span> l <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>deg <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">const</span> t <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>deg <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token keyword\">const</span> r <span class=\"token operator\">=</span> <span class=\"token constant\">R</span> <span class=\"token operator\">+</span> <span class=\"token constant\">OFFSET</span>\n\t\t<span class=\"token keyword\">const</span> x <span class=\"token operator\">=</span> <span class=\"token constant\">X</span> <span class=\"token operator\">+</span> l <span class=\"token operator\">*</span> r\n\t\t<span class=\"token keyword\">const</span> y <span class=\"token operator\">=</span> <span class=\"token constant\">Y</span> <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> r\n\t\t<span class=\"token keyword\">const</span> particleShape <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>canvas<span class=\"token punctuation\">.</span>current <span class=\"token keyword\">as</span> Canvas<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">addShape</span><span class=\"token punctuation\">(</span><span class=\"token string\">'circle'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n\t\t\tattrs<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tx<span class=\"token punctuation\">,</span>\n\t\t\t\ty<span class=\"token punctuation\">,</span>\n\t\t\t\tr<span class=\"token operator\">:</span> <span class=\"token number\">0.8</span><span class=\"token punctuation\">,</span>\n\t\t\t\tfill<span class=\"token operator\">:</span> <span class=\"token string\">'#fff'</span><span class=\"token punctuation\">,</span>\n\t\t\t\topacity<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n\t\t\t\t<span class=\"token comment\">// ⚠开启阴影会掉帧</span>\n\t\t\t\t<span class=\"token comment\">// shadowColor: '#fcc8d9',</span>\n\t\t\t\t<span class=\"token comment\">// shadowBlur: 1</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t\tparticleShape<span class=\"token punctuation\">.</span><span class=\"token function\">animate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>ratio<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">const</span> deg <span class=\"token operator\">=</span> index1 <span class=\"token operator\">*</span> <span class=\"token punctuation\">(</span><span class=\"token number\">360</span> <span class=\"token operator\">/</span> <span class=\"token constant\">POINT_NUM</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">150</span> <span class=\"token operator\">+</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>ratio <span class=\"token operator\">*</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">const</span> l <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">cos</span><span class=\"token punctuation\">(</span>deg <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">const</span> t <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">sin</span><span class=\"token punctuation\">(</span>deg <span class=\"token operator\">*</span> Math<span class=\"token punctuation\">.</span><span class=\"token constant\">PI</span> <span class=\"token operator\">/</span> <span class=\"token number\">180</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">const</span> _index <span class=\"token operator\">=</span> <span class=\"token constant\">POINT_NUM</span> <span class=\"token operator\">*</span> index1 <span class=\"token operator\">+</span> index2\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>particleActiveArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">[</span>_index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ratio <span class=\"token operator\">&lt;</span> <span class=\"token number\">0.02</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\tparticleActiveArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">[</span>_index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> \n\t\t\t\t\t\tindex1 <span class=\"token operator\">>=</span> currentActiveIndex<span class=\"token punctuation\">.</span>current <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">&amp;&amp;</span> index1 <span class=\"token operator\">&lt;=</span> currentActiveIndex<span class=\"token punctuation\">.</span>current <span class=\"token operator\">+</span> <span class=\"token number\">1</span> \n\t\t\t\t\t\t<span class=\"token operator\">?</span> <span class=\"token constant\">POINT_ACTIVE_MOVE_LENGTH</span> \n\t\t\t\t\t\t<span class=\"token operator\">:</span> <span class=\"token constant\">POINT_MOVE_LENGTH</span>\n\t\t\t\t<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ratio <span class=\"token operator\">></span> <span class=\"token number\">0.98</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\tparticleActiveArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">[</span>_index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token constant\">POINT_MOVE_LENGTH</span>\n\t\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">const</span> offset <span class=\"token operator\">=</span> particleActiveArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">[</span>_index<span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token constant\">POINT_MOVE_LENGTH</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n\t\t\t\tx<span class=\"token operator\">:</span> x <span class=\"token operator\">+</span> l <span class=\"token operator\">*</span> ratio <span class=\"token operator\">*</span> offset<span class=\"token punctuation\">,</span>\n\t\t\t\ty<span class=\"token operator\">:</span> y <span class=\"token operator\">+</span> t <span class=\"token operator\">*</span> ratio <span class=\"token operator\">*</span> offset<span class=\"token punctuation\">,</span>\n\t\t\t\topacity<span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token operator\">-</span> ratio\n\t\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n\t\t\tduration<span class=\"token operator\">:</span> <span class=\"token constant\">POINT_CREATE_DELAY</span><span class=\"token punctuation\">,</span>\n\t\t\trepeat<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\t\t\teasing<span class=\"token operator\">:</span> <span class=\"token string\">'easeSinInOut'</span>\n\t\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\t\tparticleArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>particleShape<span class=\"token punctuation\">)</span>\n\t\tparticleStartArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n\t\tparticleActiveArr<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token constant\">POINT_MOVE_LENGTH</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"其他说明\" style=\"position:relative;\"><a href=\"#%E5%85%B6%E4%BB%96%E8%AF%B4%E6%98%8E\" aria-label=\"其他说明 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>其他说明</h2>\n<p>这个项目是一个练手项目，基于<code class=\"language-text\">vite</code>、<code class=\"language-text\">React</code>、<code class=\"language-text\">Typescript</code>，因为react平时用的不多，项目中存在什么问题或写的不好的地方欢迎指点。</p>\n<p>或者有什么好看的特效也可以提ISSUE或PR交流一下怎么实现。</p>\n<p>项目Github: <a href=\"https://github.com/leon-kfd/g-music-visualizer\" target=\"_blank\"><strong>Click Here</strong></a></p>\n<p>项目Demo: <a href=\"https://leon-kfd.github.io/g-music-visualizer/\" target=\"_blank\"><strong>Click Here</strong></a></p>","frontmatter":{"title":"利用G渲染器实现的音频可视化方案","date":"June 29, 2021","description":"利用阿里Antvis出品的G底层图形渲染器，结合AudioContext提供的音频数据获取Api，实现出类似网易云播放音频特效。"}}},"pageContext":{"slug":"/g-music-visualizer/","previous":{"fields":{"slug":"/mouse-menu-introduction/"},"frontmatter":{"title":"Vue3实现自定义右键菜单"}},"next":{"fields":{"slug":"/design-of-howdz/"},"frontmatter":{"title":"Howdz起始页开发记录"}}}},"staticQueryHashes":["143701507","165057280"]}