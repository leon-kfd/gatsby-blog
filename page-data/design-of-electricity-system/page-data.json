{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/design-of-electricity-system/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Howdy"}},"markdownRemark":{"id":"2fff053c-cd09-5202-a6a3-29b621233b54","excerpt":"使用Nuxtjs + Koa + Mysql实现的极简风格电商系统，此为个人大学课余期间(2018)的练手项目，部分功能未完全实现。 DEMO系统在线预览地址: http://eidea.kongfandong.cn…","html":"<p>使用Nuxtjs + Koa + Mysql实现的极简风格电商系统，此为个人大学课余期间(2018)的练手项目，部分功能未完全实现。</p>\n<p>DEMO系统在线预览地址: <a href=\"http://eidea.kongfandong.cn\" target=\"_blank\"><a href=\"http://eidea.kongfandong.cn\">http://eidea.kongfandong.cn</a></a></p>\n<h2 id=\"系统功能\" style=\"position:relative;\"><a href=\"#%E7%B3%BB%E7%BB%9F%E5%8A%9F%E8%83%BD\" aria-label=\"系统功能 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>系统功能</h2>\n<p>✅ 登录注销<br>\n✅ 首页商品轮播<br>\n✅ 首页商品推荐<br>\n✅ 商品分类搜索<br>\n✅ 商品详情<br>\n✅ 购物车增删改<br>\n✅ 商品收藏<br>\n✅ 生成订单<br>\n❌ 个人资料/地址管理<br>\n❌ 商品规格模块<br>\n❌ 支付模块</p>\n<h2 id=\"nuxtjs相关\" style=\"position:relative;\"><a href=\"#nuxtjs%E7%9B%B8%E5%85%B3\" aria-label=\"nuxtjs相关 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nuxtjs相关</h2>\n<h3 id=\"axios封装\" style=\"position:relative;\"><a href=\"#axios%E5%B0%81%E8%A3%85\" aria-label=\"axios封装 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>axios封装</h3>\n<p>封装axios，加入拦截器，统一处理接口返回的错误请求，只有<code class=\"language-text\">code</code>为200才为正确请求，其余统一弹窗错误<code class=\"language-text\">message</code>。</p>\n<p>Nuxtjs一个特性就是服务端渲染，同时可以先由服务端请求到异步初始数据后再直出页面，使用<code class=\"language-text\">asyncData</code>方法。若要在asyncData里面使用封装后添加了拦截器的axios，则需要将axios实例注入到nuxt上下文中。这里采用了<a href=\"https://zh.nuxtjs.org/guide/plugins#%E5%90%8C%E6%97%B6%E6%B3%A8%E5%85%A5\" target=\"_blank\">同时注入</a>的方法将Axios注入Vue实例与context上下文中。</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// axios.js</span>\n<span class=\"token keyword\">import</span> axios <span class=\"token keyword\">from</span> <span class=\"token string\">'axios'</span>\n<span class=\"token keyword\">const</span> baseURL <span class=\"token operator\">=</span> <span class=\"token string\">'/api/'</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onRequest</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> config\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onResponse</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>code <span class=\"token operator\">==</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> response\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">.</span>data <span class=\"token operator\">&amp;&amp;</span> response<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string\">'未知错误'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onRequestError</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onResponseError</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> instance <span class=\"token operator\">=</span> axios<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  baseURL<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">headers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string-property property\">'Content-Type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\ninstance<span class=\"token punctuation\">.</span>interceptors<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">onRequest</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">onRequestError</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ninstance<span class=\"token punctuation\">.</span>interceptors<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">onResponse</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">onResponseError</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">get</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> params</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> instance<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> params <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">post</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> instance<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> get<span class=\"token punctuation\">,</span> post <span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> app<span class=\"token punctuation\">,</span> store <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> inject</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> nuxtAxios <span class=\"token operator\">=</span> app<span class=\"token punctuation\">.</span>$axios\n  nuxtAxios<span class=\"token punctuation\">.</span><span class=\"token function\">setHeader</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Content-Type'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'application/json'</span><span class=\"token punctuation\">)</span>\n  nuxtAxios<span class=\"token punctuation\">.</span><span class=\"token function\">onRequest</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">config</span> <span class=\"token operator\">=></span> <span class=\"token function\">onRequest</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  nuxtAxios<span class=\"token punctuation\">.</span><span class=\"token function\">onRequestError</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token function\">onRequestError</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  nuxtAxios<span class=\"token punctuation\">.</span><span class=\"token function\">onResponse</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span> <span class=\"token operator\">=></span> <span class=\"token function\">onResponse</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  nuxtAxios<span class=\"token punctuation\">.</span><span class=\"token function\">onResponseError</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token function\">onResponseError</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">inject</span><span class=\"token punctuation\">(</span><span class=\"token string\">'get'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> params</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> nuxtAxios<span class=\"token punctuation\">.</span><span class=\"token function\">$get</span><span class=\"token punctuation\">(</span>baseURL <span class=\"token operator\">+</span> url<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> params <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">inject</span><span class=\"token punctuation\">(</span><span class=\"token string\">'post'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> nuxtAxios<span class=\"token punctuation\">.</span><span class=\"token function\">$post</span><span class=\"token punctuation\">(</span>baseURL <span class=\"token operator\">+</span> url<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></span><span class=\"gatsby-highlight-code-line\">  <span class=\"token function\">inject</span><span class=\"token punctuation\">(</span><span class=\"token string\">'baseURL'</span><span class=\"token punctuation\">,</span> baseURL<span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"其余插件\" style=\"position:relative;\"><a href=\"#%E5%85%B6%E4%BD%99%E6%8F%92%E4%BB%B6\" aria-label=\"其余插件 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>其余插件</h3>\n<ul>\n<li><a href=\"https://fontawesome.com/icons\" target=\"_blank\">font-awesome</a> CSS图标库</li>\n<li><a href=\"https://github.com/hilongjw/vue-lazyload#readme\" target=\"_blank\">vue-lazyload</a> 图片懒加载</li>\n</ul>\n<h3 id=\"加入购物车动画\" style=\"position:relative;\"><a href=\"#%E5%8A%A0%E5%85%A5%E8%B4%AD%E7%89%A9%E8%BD%A6%E5%8A%A8%E7%94%BB\" aria-label=\"加入购物车动画 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>加入购物车动画</h3>\n<p>使用定位 + transition + transform + 贝塞尔曲线模拟抛物线动画效果</p>\n<p><img src=\"https://s2.loli.net/2021/12/04/GSIrLKOJPXNV1pW.gif\" alt=\"抛物线动画\"></p>\n<p>将过渡动画left设为线性，top设为为cubic-bezier(0.56, 0.15, 0.43, 0.85)时，在执行过渡时就能模拟出元素一个抛物线运动，曲线函数可以在Chrome控制台试出来</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 主要代码</span>\n<span class=\"token function\">showAnimateAddCart</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> imgEl <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'goodsImg'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> offsetTop<span class=\"token punctuation\">,</span> offsetLeft<span class=\"token punctuation\">,</span> offsetWidth<span class=\"token punctuation\">,</span> offsetHeight <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> imgEl\n  <span class=\"token keyword\">const</span> newImgEl <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Image</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  newImgEl<span class=\"token punctuation\">.</span>src <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>goodsimg\n  newImgEl<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>cssText <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"></span>\n<span class=\"token string\">    position:fixed;</span>\n<span class=\"token string\">    width: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>offsetWidth<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px;</span>\n<span class=\"token string\">    height: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>offsetHeight<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px;</span>\n<span class=\"token string\">    left: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>offsetLeft<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px;</span>\n<span class=\"token string\">    top: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>offsetTop<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px;</span>\n<span class=\"token string\">    opacity: 1;</span>\n<span class=\"token string\">    transform: rotate(0)</span><span class=\"token template-punctuation string\">`</span></span>\n  document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>newImgEl<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> cartEl <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ShoppingCartBtn'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">offsetTop</span><span class=\"token operator\">:</span> cartTop<span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">offsetLeft</span><span class=\"token operator\">:</span> cartLeft <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> cartEl<span class=\"token punctuation\">.</span>parentNode\n  newImgEl<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>cssText <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\"></span>\n<span class=\"token string\">    position:fixed;</span>\n<span class=\"token string\">    width: 0;</span>\n<span class=\"token string\">    height: 0;</span>\n<span class=\"token string\">    left: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>cartLeft<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px;</span>\n<span class=\"token string\">    top: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>cartTop<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">px;</span>\n<span class=\"token string\">    opacity: 0;</span>\n<span class=\"token string\">    transform: rotate(360deg);</span>\n<span class=\"token string\">    transition: width 1s, </span>\n<span class=\"token string\">    height 1s,</span>\n<span class=\"token string\">    left 1s,</span>\n<span class=\"gatsby-highlight-code-line\"><span class=\"token string\">    top 1s cubic-bezier(0.56, 0.15, 0.43, 0.85),</span></span><span class=\"token string\">    opacity 1s ease-out,</span>\n<span class=\"token string\">    transform 1s ease-out</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>newImgEl<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"关于nuxtjs部署\" style=\"position:relative;\"><a href=\"#%E5%85%B3%E4%BA%8Enuxtjs%E9%83%A8%E7%BD%B2\" aria-label=\"关于nuxtjs部署 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>关于Nuxtjs部署</h3>\n<p>因为网站有动态数据，所有无法使用npm run generate的方式生成静态资源来部署。只能通过npm run build，然后npm run start启动一个服务来跑。这是还是要保留开发环境用的proxy环境，使用反向代理方式代理所有后端接口。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// nuxt.config.js</span>\n<span class=\"token literal-property property\">proxy</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">'/api/'</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">target</span><span class=\"token operator\">:</span> <span class=\"token string\">'http://localhost:3001'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">pathRewrite</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">'^/api/'</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"后端koa相关\" style=\"position:relative;\"><a href=\"#%E5%90%8E%E7%AB%AFkoa%E7%9B%B8%E5%85%B3\" aria-label=\"后端koa相关 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>后端Koa相关</h2>\n<p>后端只用作一个普通的接口服务器，涉及的技术不多，只用到了几个基本的koa插件</p>\n<ul>\n<li>koa-router</li>\n<li>koa-session</li>\n<li>koa-static</li>\n<li>koa-bodyparser</li>\n<li>mysql</li>\n</ul>\n<h3 id=\"备注\" style=\"position:relative;\"><a href=\"#%E5%A4%87%E6%B3%A8\" aria-label=\"备注 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>备注</h3>\n<ol>\n<li>SQL语句尽量都采用<code class=\"language-text\">escaping query values</code>，使用<code class=\"language-text\">?</code>占位符代替变量，可以防止SQL注入攻击</li>\n<li>SQL查询分页，查询总数时可以采用子查询方法，虽然性能差别不大，但是代码看上去可以较简洁</li>\n</ol>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// 搜索商品</span>\nrouter<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/query'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token parameter\">ctx</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>\n    sex<span class=\"token punctuation\">,</span>\n    classify<span class=\"token punctuation\">,</span>\n    page <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    pageSize <span class=\"token operator\">=</span> <span class=\"token number\">12</span><span class=\"token punctuation\">,</span>\n    minPrice <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    maxPrice <span class=\"token operator\">=</span> <span class=\"token number\">99999</span><span class=\"token punctuation\">,</span>\n    order <span class=\"token operator\">=</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span>\n    word\n  <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> ctx<span class=\"token punctuation\">.</span>query\n  <span class=\"token keyword\">let</span> sql <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">select * from goods where goodsprice between ? and ? </span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token keyword\">let</span> paramsArr <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>minPrice<span class=\"token punctuation\">,</span> maxPrice<span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    sql <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">and sex = ? </span><span class=\"token template-punctuation string\">`</span></span>\n    paramsArr<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>sex<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>classify<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    sql <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">and classify = ? </span><span class=\"token template-punctuation string\">`</span></span>\n    paramsArr<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>classify<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    sql <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">and goodsname like ? or goodsdetail like ? </span><span class=\"token template-punctuation string\">`</span></span>\n    paramsArr<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">%</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>word<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">%</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">%</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>word<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">%</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">const</span> totalSql <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">select count(*) as total from (</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>sql<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">) as temp </span><span class=\"token template-punctuation string\">`</span></span></span>  <span class=\"token keyword\">const</span> totalResult <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span>totalSql<span class=\"token punctuation\">,</span> paramsArr<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>totalResult<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> r<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>order <span class=\"token operator\">===</span> <span class=\"token string\">'low'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      sql <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">order by goodsprice </span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>order <span class=\"token operator\">===</span> <span class=\"token string\">'high'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      sql <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">order by goodsprice desc </span><span class=\"token template-punctuation string\">`</span></span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  sql <span class=\"token operator\">+=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">limit ?, ? </span><span class=\"token template-punctuation string\">`</span></span>\n  paramsArr<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>page <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> pageSize<span class=\"token punctuation\">,</span> pageSize<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">query</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">,</span> paramsArr<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>result<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> r<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">;</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">}</span>\n  ctx<span class=\"token punctuation\">.</span>body <span class=\"token operator\">=</span> r<span class=\"token punctuation\">.</span><span class=\"token function\">successPage</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> page<span class=\"token punctuation\">,</span> pageSize<span class=\"token punctuation\">,</span> totalResult<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>total<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"网站截图\" style=\"position:relative;\"><a href=\"#%E7%BD%91%E7%AB%99%E6%88%AA%E5%9B%BE\" aria-label=\"网站截图 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>网站截图</h2>\n<ol>\n<li><strong>首页</strong></li>\n</ol>\n<p><img src=\"https://s2.loli.net/2021/12/04/wxI5W4KsCBYncuk.png\" alt=\"首页.jpg\">\n2. <strong>搜索页</strong>\n<img src=\"https://s2.loli.net/2021/12/04/kPg3fHJIsMvD68o.png\" alt=\"搜索.jpg\">\n3. <strong>购物车</strong>\n<img src=\"https://s2.loli.net/2021/12/04/iLDbIzdspo3tgwy.png\" alt=\"购物车.jpg\">\n4. <strong>订单</strong>\n<img src=\"https://s2.loli.net/2021/12/04/uIpYdnAq4Kb35WP.png\" alt=\"订单.jpg\">\n5. <strong>个人中心</strong>\n<img src=\"https://s2.loli.net/2021/12/04/xL51dQUCFKh4Tfz.png\" alt=\"个人中心.jpg\"></p>\n<p><strong>PS: 该项目仅作学习交流所用，不可作商业用途，所有图片来源于网上</strong></p>\n<p><em>以上内容未经授权请勿随意转载。</em></p>\n<p>DEMO系统在线预览地址: <a href=\"http://eidea.kongfandong.cn\" target=\"_blank\"><a href=\"http://eidea.kongfandong.cn\">http://eidea.kongfandong.cn</a></a></p>","frontmatter":{"title":"简易电商系统开发记录(Nuxtjs+Koa)","date":"January 30, 2019","description":"使用Nuxtjs + Koa + Mysql实现的电商系统，功能未完全开发完，编写该文档记录之前开发遇到部分问题与系统设计总结"}}},"pageContext":{"slug":"/design-of-electricity-system/","previous":{"fields":{"slug":"/design-of-exam-system/"},"frontmatter":{"title":"考试系统设计总结"}},"next":{"fields":{"slug":"/personal-code-collection/"},"frontmatter":{"title":"个人常用代码收藏"}}}},
    "staticQueryHashes": ["143701507","165057280"]}