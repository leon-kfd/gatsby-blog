{"componentChunkName":"component---src-templates-blog-post-js","path":"/design-of-weapp-file-system/","result":{"data":{"site":{"siteMetadata":{"title":"Howdy"}},"markdownRemark":{"id":"fc01ea95-8911-5747-8610-006d7f89da15","excerpt":"前言 笔者之前实现了一个PC端的个人网盘功能，包含断点续传、文件秒传的文件管理系统，具体请参考文章《断点续传与个人网盘系统的前后端设计》 于是构思想将个人网盘功能扩展到小程序，沿用之前的后端（接口基本不需要改动），只需要完成移动端的UI实现即可。又由于PC端是基于Vue…","html":"<h2 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<p>笔者之前实现了一个PC端的个人网盘功能，包含断点续传、文件秒传的文件管理系统，具体请参考文章<strong><a href=\"https://kongfandong.cn/blog/design-of-file-system/\">《断点续传与个人网盘系统的前后端设计》</a></strong></p>\n<p>于是构思想将个人网盘功能扩展到小程序，沿用之前的后端（接口基本不需要改动），只需要完成移动端的UI实现即可。又由于PC端是基于Vue实现的，为了方便开发所以想直接采用跨平台框架，将vue代码转成小程序，而且这样还可以考虑后续转出H5或原生手机客户端等。</p>\n<p><em>基于功能的原因，该小程序原则上不可能通过审核，所以只会作为个人练手项目。</em></p>\n<h2 id=\"跨平台框架选型\" style=\"position:relative;\"><a href=\"#%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%A1%86%E6%9E%B6%E9%80%89%E5%9E%8B\" aria-label=\"跨平台框架选型 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>跨平台框架选型</h2>\n<p>关于跨平台框架的选型，对比了当前主要用的3个框架</p>\n<ul>\n<li><strong><a href=\"https://github.com/Meituan-Dianping/mpvue\" target=\"_blank\">mpvue</a></strong>: 美团开源的使用 Vue.js 开发小程序的前端框架，但当前好像好久没人维护了</li>\n<li><strong><a href=\"https://uniapp.dcloud.io\" target=\"_blank\">uniapp</a></strong>: uni-app 是一个使用 Vue.js 开发小程序、H5、App的统一前端框架</li>\n<li><strong><a href=\"https://taro-docs.jd.com/taro/docs/3.0.0-beta.5/README/\" target=\"_blank\">Taro-next</a></strong>: 京东开源的多端开发框架，2.X版本是需使用React的，当前beta3.X版本对vue加入了支持。</li>\n</ul>\n<p>对比了下，最终还是觉得选用Taro-next进行开发，虽然当前还是beta版，但是文档已经完善了，基本不影响使用。</p>\n<h2 id=\"安装与启动\" style=\"position:relative;\"><a href=\"#%E5%AE%89%E8%A3%85%E4%B8%8E%E5%90%AF%E5%8A%A8\" aria-label=\"安装与启动 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>安装与启动</h2>\n<p>Taro安装参考<a href=\"https://taro-docs.jd.com/taro/docs/3.0.0-beta.5/GETTING-STARTED\" target=\"_blank\">官方文档</a>，先全局安装Taro脚手架，再初始化一个项目，安装依赖。</p>\n<p>使用<code class=\"language-text\">npm run dev:weapp</code>启动开发环境，然后使用<code class=\"language-text\">微信开发者工具</code>导入项目即可进行预览（最好申请一个小程序Id，以便后续可以真机预览等功能）。</p>\n<h2 id=\"引入vant-weapp-ui框架\" style=\"position:relative;\"><a href=\"#%E5%BC%95%E5%85%A5vant-weapp-ui%E6%A1%86%E6%9E%B6\" aria-label=\"引入vant weapp ui框架 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>引入Vant-weapp UI框架</h2>\n<p>可以直接下载vant-weapp的生成包，直接放在目录下。然后就可以在页面的配置下引入自定义组件，Taro会自动将这些同步到打包后的文件夹。微信小程序打包的时候也会自动去除没用到的包。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// index.config.js</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  usingComponents<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"van-icon\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"../../components/vant/icon/index\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'van-action-sheet'</span><span class=\"token operator\">:</span> <span class=\"token string\">'../../components/vant/action-sheet/index'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'van-notify'</span><span class=\"token operator\">:</span> <span class=\"token string\">'../../components/vant/notify/index'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'van-dialog'</span><span class=\"token operator\">:</span> <span class=\"token string\">'../../components/vant/dialog/index'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'van-field'</span><span class=\"token operator\">:</span> <span class=\"token string\">'../../components/vant/field/index'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"van-checkbox\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"../../components/vant/checkbox/index\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"van-checkbox-group\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"../../components/vant/checkbox-group/index\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"van-progress\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"../../components/vant/progress/index\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"van-toast\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"../../components/vant/toast/index\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>具体请参考: </p>\n<ul>\n<li><a href=\"https://taro-docs.jd.com/taro/docs/3.0.0-beta.5/mini-third-party#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6\" target=\"_blank\">Taro-使用小程序原生第三方组件和插件</a></li>\n<li><a href=\"https://youzan.github.io/vant-weapp/#/quickstart\" target=\"_blank\">Vant-weapp官方文档</a></li>\n</ul>\n<p>另外，一些Vant的全局组件可以挂载到Vue的实例上，方便使用。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// app.js</span>\n<span class=\"token keyword\">import</span> Vue <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">import</span> Notify <span class=\"token keyword\">from</span> <span class=\"token string\">'./components/vant/notify/notify'</span>\n<span class=\"token keyword\">import</span> Dialog <span class=\"token keyword\">from</span> <span class=\"token string\">'./components/vant/dialog/dialog'</span>\n<span class=\"token keyword\">import</span> Toast <span class=\"token keyword\">from</span> <span class=\"token string\">'./components/vant/toast/toast'</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token class-name\">Vue</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>$notify <span class=\"token operator\">=</span> Notify\n<span class=\"token class-name\">Vue</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>$dialog <span class=\"token operator\">=</span> Dialog\n<span class=\"token class-name\">Vue</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>$toast <span class=\"token operator\">=</span> Toast\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">const</span> App <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  store<span class=\"token punctuation\">,</span>\n  <span class=\"token function\">onShow</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">render</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">h</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">h</span><span class=\"token punctuation\">(</span><span class=\"token string\">'block'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$slots<span class=\"token punctuation\">.</span>default<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App</code></pre></div>\n<p>使用时需注意，vant该3个组件是要先定义默认节点的，要在一个全局的vue中加入以下节点代码</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>van-notify</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>van-notify<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>van-dialog</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>van-dialog<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>van-toast</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>van-toast<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>然后就可以在vue中使用</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Notify</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'danger'</span><span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> e <span class=\"token operator\">||</span> <span class=\"token string\">'登录失败'</span><span class=\"token punctuation\">,</span> duration<span class=\"token operator\">:</span> <span class=\"token number\">1000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Dialog</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$dialog<span class=\"token punctuation\">.</span><span class=\"token function\">confirm</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  message<span class=\"token operator\">:</span> <span class=\"token string\">'此操作会将文件移动到回收站，你可在一个月内进行恢复操作，一个月后将永久删除'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// do something</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// on cancel</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Toast</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$toast<span class=\"token punctuation\">.</span><span class=\"token function\">loading</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  mask<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  message<span class=\"token operator\">:</span> <span class=\"token string\">'上传中...'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"请求封装\" style=\"position:relative;\"><a href=\"#%E8%AF%B7%E6%B1%82%E5%B0%81%E8%A3%85\" aria-label=\"请求封装 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>请求封装</h2>\n<p>可以为请求加入请求拦截与响应拦截，基于<a href=\"https://taro-docs.jd.com/taro/docs/3.0.0-beta.5/apis/network/request/request\" target=\"_blank\">Taro.request</a></p>\n<ul>\n<li>封装一些请求头，如<code class=\"language-text\">content-type: application/json</code></li>\n<li>提取<code class=\"language-text\">baseURL</code>，将请求前缀提取出来配置，方便修改</li>\n<li><code class=\"language-text\">请求拦截器</code>：将sessionId注入到请求头</li>\n<li><code class=\"language-text\">响应拦截器</code>：只给errCode为200的请求通过，其余请求为错误请求，直接使用Notify组件自动弹出错误信息</li>\n</ul>\n<p>参考代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// fetch.js</span>\n<span class=\"token keyword\">import</span> Taro <span class=\"token keyword\">from</span> <span class=\"token string\">'@tarojs/taro'</span>\n<span class=\"token keyword\">import</span> Notify <span class=\"token keyword\">from</span> <span class=\"token string\">'../components/vant/notify/notify'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">interceptor</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">chain</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> requestParams <span class=\"token operator\">=</span> chain<span class=\"token punctuation\">.</span>requestParams\n  <span class=\"token keyword\">const</span> sessionId <span class=\"token operator\">=</span> Taro<span class=\"token punctuation\">.</span><span class=\"token function\">getStorageSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sessionId'</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sessionId<span class=\"token punctuation\">)</span> requestParams<span class=\"token punctuation\">.</span>header<span class=\"token punctuation\">.</span>sessionId <span class=\"token operator\">=</span> sessionId\n  <span class=\"token keyword\">return</span> chain<span class=\"token punctuation\">.</span><span class=\"token function\">proceed</span><span class=\"token punctuation\">(</span>requestParams<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span>data\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>errCode <span class=\"token operator\">===</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">Notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">'danger'</span><span class=\"token punctuation\">,</span>\n        selector<span class=\"token operator\">:</span> <span class=\"token string\">'#van-notify'</span><span class=\"token punctuation\">,</span>\n        message<span class=\"token operator\">:</span> data<span class=\"token punctuation\">.</span>errMsg<span class=\"token punctuation\">,</span>\n        duration<span class=\"token operator\">:</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span> Promise<span class=\"token punctuation\">.</span><span class=\"token function\">reject</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>errMsg<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token parameter\">err</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">Notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      type<span class=\"token operator\">:</span> <span class=\"token string\">'danger'</span><span class=\"token punctuation\">,</span>\n      selector<span class=\"token operator\">:</span> <span class=\"token string\">'#van-notify'</span><span class=\"token punctuation\">,</span>\n      message<span class=\"token operator\">:</span> <span class=\"token string\">'服务端异常'</span><span class=\"token punctuation\">,</span>\n      duration<span class=\"token operator\">:</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> err<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\nTaro<span class=\"token punctuation\">.</span><span class=\"token function\">addInterceptor</span><span class=\"token punctuation\">(</span>interceptor<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> baseURL <span class=\"token operator\">=</span> <span class=\"token string\">'http://localhost:5001/storage'</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">instance</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">method<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> options</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> Taro<span class=\"token punctuation\">.</span><span class=\"token function\">request</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    dataType<span class=\"token operator\">:</span> <span class=\"token string\">'json'</span><span class=\"token punctuation\">,</span>\n    header<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string\">'content-type'</span><span class=\"token operator\">:</span> <span class=\"token string\">'application/json'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    method<span class=\"token punctuation\">,</span>\n    url<span class=\"token operator\">:</span> baseURL <span class=\"token operator\">+</span> url<span class=\"token punctuation\">,</span>\n    data<span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">...</span>options\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>将封装的实例像全局组件那样挂载到Vue的实例上，方便使用。</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// app.js</span>\n<span class=\"token keyword\">import</span> Vue <span class=\"token keyword\">from</span> <span class=\"token string\">'vue'</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> instance<span class=\"token punctuation\">,</span> baseURL <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./utils/fetch'</span>\n<span class=\"token comment\">// ...</span>\n<span class=\"token class-name\">Vue</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">$get</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> options</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">instance</span><span class=\"token punctuation\">(</span><span class=\"token string\">'get'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span>\n<span class=\"token class-name\">Vue</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">$post</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> options</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">instance</span><span class=\"token punctuation\">(</span><span class=\"token string\">'post'</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span>\n<span class=\"token class-name\">Vue</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>$baseURL <span class=\"token operator\">=</span> baseURL\n<span class=\"token comment\">// ...</span>\n<span class=\"token keyword\">const</span> App <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Vue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  store<span class=\"token punctuation\">,</span>\n  <span class=\"token function\">onShow</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">options</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">render</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">h</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">h</span><span class=\"token punctuation\">(</span><span class=\"token string\">'block'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$slots<span class=\"token punctuation\">.</span>default<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App</code></pre></div>\n<p>然后就在vue中使用:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// get</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$get</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/getFileList'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  currentPath<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentPathParams\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>fileList <span class=\"token operator\">=</span> data\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">//post</span>\n<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/delete'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  deleteList\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> <span class=\"token string\">'操作成功'</span><span class=\"token punctuation\">,</span> duration<span class=\"token operator\">:</span> <span class=\"token number\">1000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'onNeedRefresh'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"关于文件上传\" style=\"position:relative;\"><a href=\"#%E5%85%B3%E4%BA%8E%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0\" aria-label=\"关于文件上传 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>关于文件上传</h2>\n<p>微信的文件上传并不能拿到文件实例，查了好多资料，并无找到能够进行文件分片的功能，所有不能实现断点续传了。这次直接使用了简单的单文件上传，后端添加了一个simpleUpload接口接收，其余操作在这就不细说了。</p>\n<p>微信并无提供直接调用系统文件管理器的API（可能也没权限），这次采用了微信提供的以下几种方式取代</p>\n<ul>\n<li>wx.chooseImage: 从本地相册选择图片或使用相机拍照</li>\n<li>wx.chooseVideo: 拍摄视频或从手机相册中选视频</li>\n<li>wx.chooseMessageFile: 从客户端会话选择文件</li>\n</ul>\n<p>这几个接口都会返回一个含有选取路径的成功回调，能拿到文件路径进行上传</p>\n<div style=\"width:45%;display:inline-block;margin-right:5%\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 375px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 177.99999999999997%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAkABQDASIAAhEBAxEB/8QAGgAAAQUBAAAAAAAAAAAAAAAAAAECAwUGBP/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAZFqlLQ4AiXSTmXNODmgPAP/xAAbEAACAgMBAAAAAAAAAAAAAAAAAQIQERIUBP/aAAgBAQABBQLskdkhep2rRjBrE1iYRGv/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/AV//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AV//xAAaEAADAQADAAAAAAAAAAAAAAAAATEyAhAg/9oACAEBAAY/AscTKML3CIiJ3//EACAQAAICAgAHAAAAAAAAAAAAAAABMZEQESFBUWGB4fH/2gAIAQEAAT8h0RYdO8Y22NCI48kRo3BaPgD9UbuSiDXfH//aAAwDAQACAAMAAAAQswI8cA//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAEDAQE/EF//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/EF//xAAfEAEAAgEEAwEAAAAAAAAAAAABABEhMUFhgVFxodH/2gAIAQEAAT8QHYXaUDq+ctxq7r4mK9nmLayuCanuXjV+Qq/1GWzvM3eCxbBCxzgRDl+sVWq+UTHEAYABR1Gf/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"upload mode\" title=\"upload mode\" src=\"/blog/static/41492f098cf7bcb54bf1b3f200ead006/8a6f5/upload-mode.jpg\" srcset=\"/blog/static/41492f098cf7bcb54bf1b3f200ead006/0cdb7/upload-mode.jpg 300w,\n/blog/static/41492f098cf7bcb54bf1b3f200ead006/8a6f5/upload-mode.jpg 375w\" sizes=\"(max-width: 375px) 100vw, 375px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n</div>\n<div style=\"width:45%;display:inline-block\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 371px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 179%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAkABQDASIAAhEBAxEB/8QAGQAAAwEBAQAAAAAAAAAAAAAAAAIDAQQF/8QAFgEBAQEAAAAAAAAAAAAAAAAAAAEC/9oADAMBAAIQAxAAAAH12x5JHQJNpvdUMBMAcCP/xAAcEAACAgIDAAAAAAAAAAAAAAAAAQIQESIjMUH/2gAIAQEAAQUC3OQxOk7VMUlXqioi6//EABcRAAMBAAAAAAAAAAAAAAAAAAAREiD/2gAIAQMBAT8BkWf/xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AV//xAAcEAACAgIDAAAAAAAAAAAAAAAAQQEQAjERIUL/2gAIAQEABj8C1ieTWAhUx0juYueHNf/EACAQAAIBAwQDAAAAAAAAAAAAAAABERAhMUFhcZGhwdH/2gAIAQEAAT8hUR4dhvct3JK7vRsvQvCl+72JT7UgleN3ln1KkDK2TImo/9oADAMBAAIAAwAAABCo6EwEP//EABgRAQEBAQEAAAAAAAAAAAAAAAERACBx/9oACAEDAQE/EGGV3ty1vH//xAAXEQEBAQEAAAAAAAAAAAAAAAABEQAQ/9oACAECAQE/EA00nBY8/8QAHhABAAICAgMBAAAAAAAAAAAAAQARIUFRsTFhkXH/2gAIAQEAAT8QVWNvlIOdZ3lFCd2lepYN6X6O4VGA6GRq3xAY9bbqEmyvsJM3uNGVcXO4AfhjDnH2UGZq/EETLZVOfUuClebn/9k='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"upload success\" title=\"upload success\" src=\"/blog/static/880ca971dd7f44c868f46635f5fdc67a/bfbf0/upload-success.jpg\" srcset=\"/blog/static/880ca971dd7f44c868f46635f5fdc67a/0cdb7/upload-success.jpg 300w,\n/blog/static/880ca971dd7f44c868f46635f5fdc67a/bfbf0/upload-success.jpg 371w\" sizes=\"(max-width: 371px) 100vw, 371px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\">\n    </span>\n</div>\n<br>\n<br>\n<p>上传逻辑</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">handleUploadFile</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">type <span class=\"token operator\">=</span> <span class=\"token number\">1</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">callback</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'update:actionVisible'</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$toast<span class=\"token punctuation\">.</span><span class=\"token function\">loading</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      mask<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      message<span class=\"token operator\">:</span> <span class=\"token string\">'上传中...'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">const</span> filePaths <span class=\"token operator\">=</span> type <span class=\"token operator\">===</span> <span class=\"token number\">3</span> <span class=\"token operator\">?</span> res<span class=\"token punctuation\">.</span>tempFiles<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> item<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> res<span class=\"token punctuation\">.</span>tempFilePaths\n    Promise<span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span>\n      filePaths<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">item</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> Taro<span class=\"token punctuation\">.</span><span class=\"token function\">uploadFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n          url<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$baseURL <span class=\"token operator\">+</span> <span class=\"token string\">'/simpleUpload'</span><span class=\"token punctuation\">,</span>\n          filePath<span class=\"token operator\">:</span> item<span class=\"token punctuation\">,</span>\n          name<span class=\"token operator\">:</span> <span class=\"token string\">'file'</span><span class=\"token punctuation\">,</span>\n          formData<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            targetPath<span class=\"token operator\">:</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentPathArr<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          header<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            sessionid<span class=\"token operator\">:</span> Taro<span class=\"token punctuation\">.</span><span class=\"token function\">getStorageSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sessionId'</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span>errCode <span class=\"token operator\">===</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> fileName <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> res<span class=\"token punctuation\">.</span>data\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">上传成功，文件保存为</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>fileName<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> duration<span class=\"token operator\">:</span> <span class=\"token number\">2000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'onNeedRefresh'</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">上传失败，</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>res<span class=\"token punctuation\">.</span>errMsg<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> duration<span class=\"token operator\">:</span> <span class=\"token number\">2000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'success'</span><span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">上传失败，服务端错误</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> duration<span class=\"token operator\">:</span> <span class=\"token number\">2000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$toast<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>type <span class=\"token operator\">===</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    wx<span class=\"token punctuation\">.</span><span class=\"token function\">chooseImage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      count<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      sizeType<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'original'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'compressed'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      sourceType<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'album'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'camera'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">success</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>type <span class=\"token operator\">===</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    wx<span class=\"token punctuation\">.</span><span class=\"token function\">chooseVideo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      sourceType<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'album'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'camera'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      maxDuration<span class=\"token operator\">:</span> <span class=\"token number\">60</span><span class=\"token punctuation\">,</span>\n      camera<span class=\"token operator\">:</span> <span class=\"token string\">'back'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">success</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>type <span class=\"token operator\">===</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    wx<span class=\"token punctuation\">.</span><span class=\"token function\">chooseMessageFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      count<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">success</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"文件预览\" style=\"position:relative;\"><a href=\"#%E6%96%87%E4%BB%B6%E9%A2%84%E8%A7%88\" aria-label=\"文件预览 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>文件预览</h2>\n<p>由于微信小程序文件存储最大为10M，所以基本不可能实现下载功能了。于是把下载功能改成了在线预览功能，当前支持以下几种文件类型</p>\n<ul>\n<li>办公文档（doc、docx、xls、xlsx、ppt、pptx、pdf）：这几种文档都可以通过<code class=\"language-text\">Taro.openDocument</code>API实现预览操作</li>\n<li>图片（jpg、png、svg、gif）：拿到图片临时地址后，使用浮层和<code class=\"language-text\">image</code>组件显示</li>\n<li>视频（mp4、mov、m4v、3gp、avi、m3u8）：直接将视频地址放到浮层的<code class=\"language-text\">video</code>组件中显示</li>\n</ul>\n<p>以上，除了视频外，其余都是要先通过<code class=\"language-text\">wx.downloadFile</code>将文件下载到本地生成临时路径再执行相应预览操作，这时候可以添加下载进度条优化用户体验。而视频不会直接进行下载，需要后端将视频资源设为流视频（<code class=\"language-text\">Accept-Range</code>），这样视频可以一边下载一边播放。</p>\n<p><img src=\"/blog/c63fea750458a812b85d84a293113404/%E6%96%87%E4%BB%B6%E9%A2%84%E8%A7%88.gif\" alt=\"图片预览\"></p>\n<p><em>进度条使用微信原生请求事件<code class=\"language-text\">onProgressUpdate</code>实现</em></p>\n<p>主要代码</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">handleActionPreview</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> target <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>actionFileInfo\n  <span class=\"token keyword\">const</span> targetPath <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>currentPathArr<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token string\">'/'</span> <span class=\"token operator\">+</span> target<span class=\"token punctuation\">.</span>fileName\n  <span class=\"token keyword\">const</span> realPath <span class=\"token operator\">=</span> targetPath<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'$Root'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>$baseURL<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> sessionId <span class=\"token operator\">=</span> Taro<span class=\"token punctuation\">.</span><span class=\"token function\">getStorageSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sessionId'</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>videoSuffixArr<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span>suffix<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span>    <span class=\"token comment\">// 视频直接展示</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">handleActionCancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mediaPreviewVisible <span class=\"token operator\">=</span> <span class=\"token number\">2</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>videoPreviewURL <span class=\"token operator\">=</span> realPath <span class=\"token operator\">+</span> <span class=\"token string\">'?sessionid='</span> <span class=\"token operator\">+</span> Taro<span class=\"token punctuation\">.</span><span class=\"token function\">getStorageSync</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sessionId'</span><span class=\"token punctuation\">)</span>\n<span class=\"gatsby-highlight-code-line\">  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>previewArr<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span>suffix<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span></span>    <span class=\"token comment\">// 其他类型先下载</span>\n<span class=\"gatsby-highlight-code-line\">    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>downloadTask <span class=\"token operator\">=</span> wx<span class=\"token punctuation\">.</span><span class=\"token function\">downloadFile</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span></span>      url<span class=\"token operator\">:</span> realPath<span class=\"token punctuation\">,</span>\n      header<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">'sessionid'</span><span class=\"token operator\">:</span> sessionId\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">success</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> tempFilePath <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> data\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>imgSuffixArr<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span>suffix<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mediaPreviewVisible <span class=\"token operator\">=</span> <span class=\"token number\">1</span>\n          <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>imgPreviewURL <span class=\"token operator\">=</span> tempFilePath\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>documentSuffixArr<span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>target<span class=\"token punctuation\">.</span>suffix<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">          Taro<span class=\"token punctuation\">.</span><span class=\"token function\">openDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span></span><span class=\"gatsby-highlight-code-line\">            filePath<span class=\"token operator\">:</span> tempFilePath</span><span class=\"gatsby-highlight-code-line\">          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></span>        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">handleActionCancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function-variable function\">fail</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">$notify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> type<span class=\"token operator\">:</span> <span class=\"token string\">'danger'</span><span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">下载失败</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> duration<span class=\"token operator\">:</span> <span class=\"token number\">2000</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>downloadTask<span class=\"token punctuation\">.</span><span class=\"token function\">onProgressUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"gatsby-highlight-code-line\">      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>isDownloading <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></span>      <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> progress<span class=\"token punctuation\">,</span> totalBytesWritten<span class=\"token punctuation\">,</span> totalBytesExpectedToWrite <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> res\n      <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>downloadingInfo <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> progress<span class=\"token punctuation\">,</span> totalBytesWritten<span class=\"token punctuation\">,</span> totalBytesExpectedToWrite <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><em>PS：后端是Koa服务，使用了<code class=\"language-text\">koa-range</code>为静态资源下的视频实现分段请求功能，视频就可以一边下载一边播放，在chrome中视频可以进行拖动进度条，若不使用这个，在chrome中视频是无法拖动进度条的。</em></p>\n<h2 id=\"其余功能\" style=\"position:relative;\"><a href=\"#%E5%85%B6%E4%BD%99%E5%8A%9F%E8%83%BD\" aria-label=\"其余功能 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>其余功能</h2>\n<h3 id=\"批量操作\" style=\"position:relative;\"><a href=\"#%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C\" aria-label=\"批量操作 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>批量操作</h3>\n<p>使用了van-checkgroup实现，直接更换当前文件列表，但尽量保持节点位置没发生改变，可防止界面回流影响性能。</p>\n<p><img src=\"/blog/fa4c6894853af7269d7183045cf992b5/%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C.gif\" alt=\"批量操作\"></p>\n<h3 id=\"移动文件\" style=\"position:relative;\"><a href=\"#%E7%A7%BB%E5%8A%A8%E6%96%87%E4%BB%B6\" aria-label=\"移动文件 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>移动文件</h3>\n<p>该功能对应PC端上的移动，可以选择文件仅移动或者是复制，PC端是使用一个树形组件进行选择文件夹。但发现Vant等并没有相关树形组件，可能需要自己封装一个，然后直接采用了用户点击移动操作后，记录选择的文件信息，然后用户需要进入到相应目录下进行粘贴操作。</p>\n<p><img src=\"/blog/cd5c4fd8fbe7b140686edcaaebbdad43/%E7%A7%BB%E5%8A%A8%E6%96%87%E4%BB%B6.gif\" alt=\"移动文件\"></p>\n<h2 id=\"关于打包发布\" style=\"position:relative;\"><a href=\"#%E5%85%B3%E4%BA%8E%E6%89%93%E5%8C%85%E5%8F%91%E5%B8%83\" aria-label=\"关于打包发布 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>关于打包发布</h2>\n<p>执行命令<code class=\"language-text\">npm run build:weapp</code>后，其余操作与正常小程序一样。</p>","frontmatter":{"title":"使用Taro-next将个人网盘功能扩展到微信小程序","date":"May 31, 2020","description":"使用Taro-next将vue代码转成微信小程序，将个人网盘功能在微信小程序中实现，使用了Vant-weapp的UI框架"}}},"pageContext":{"slug":"/design-of-weapp-file-system/","previous":{"fields":{"slug":"/vite-pratice-todolist/"},"frontmatter":{"title":"Vue3上手: 使用vite实现一个简单的todolist应用"}},"next":{"fields":{"slug":"/d3-mulitpoint-connection/"},"frontmatter":{"title":"使用D3.js将离散的点形成平滑曲线及其应用"}}}},"staticQueryHashes":["143701507","165057280"]}