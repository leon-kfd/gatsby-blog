{"componentChunkName":"component---src-templates-blog-post-js","path":"/design-of-howdz/","result":{"data":{"site":{"siteMetadata":{"title":"Howdy"}},"markdownRemark":{"id":"cf156ad5-657d-557b-89b5-f453eca8f239","excerpt":"前言 Howdz是基于 + 开发的一个完全自定义配置的浏览器导航起始页，支持按需添加物料组件，可自由编辑组件的位置、大小与功能。支持响应式设计，可自定义随机壁纸、动态壁纸等。项目提供网页在线访问、打包出浏览器插件、打包出桌面应用(Electron…","html":"<h2 id=\"前言\" style=\"position:relative;\"><a href=\"#%E5%89%8D%E8%A8%80\" aria-label=\"前言 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>前言</h2>\n<p><strong><a href=\"https://howdz.vercel.app\">Howdz</a></strong>是基于<code class=\"language-text\">Vue3</code> + <code class=\"language-text\">Typescript</code>开发的一个完全自定义配置的浏览器导航起始页，支持按需添加物料组件，可自由编辑组件的位置、大小与功能。支持响应式设计，可自定义随机壁纸、动态壁纸等。项目提供<a href=\"https://s.kongfandong.cn\">网页在线访问</a>、打包出<a href=\"https://microsoftedge.microsoft.com/addons/detail/howdz%E8%B5%B7%E5%A7%8B%E9%A1%B5/cgcggcdgjfmeoemmdpleinicgepijegd\">浏览器插件</a>、打包出<a href=\"https://github.com/leon-kfd/Dashboard/releases\">桌面应用(Electron)</a>等访问方式。</p>\n<p>本文记录项目开发中使用的相关技术。</p>\n<h2 id=\"表单封装\" style=\"position:relative;\"><a href=\"#%E8%A1%A8%E5%8D%95%E5%B0%81%E8%A3%85\" aria-label=\"表单封装 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>表单封装</h2>\n<p>项目中运行自由添加各种物料组件，而每一个物料组件都含有自己的配置项表单，而其中又有部分相同的配置项，所以可以实现一个JS数据驱动的表单封装。</p>\n<p>当前使用了<code class=\"language-text\">ElementPlus</code>框架，封装了一个StandardForm组件，为其传入<code class=\"language-text\">formData</code>与<code class=\"language-text\">formConf</code>两个属性即可生成双向绑定的表单，支持<code class=\"language-text\">JSX</code>插入其他自定义组件。因篇幅问题，组件封装代码可参考此处: <a href=\"https://github.com/leon-kfd/Dashboard/blob/main/src/plugins/standard-form/src/standard-form.vue\">standard-form.vue</a></p>\n<p>然后可以使用类似JSON的格式，实现各个物料组件的配置表单，例如<code class=\"language-text\">Weather</code>组件的<code class=\"language-text\">setting.tsx</code>如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// @/materials/Weather/setting.tsx</span>\n<span class=\"token keyword\">import</span> pick <span class=\"token keyword\">from</span> <span class=\"token string\">'../base'</span> <span class=\"token comment\">// pick可以自由选取公用的配置</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  formData<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    weatherMode<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n    cityName<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n    animationIcon<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    duration<span class=\"token operator\">:</span> <span class=\"token number\">15</span><span class=\"token punctuation\">,</span>\n    position<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n    baseFontSize<span class=\"token operator\">:</span> <span class=\"token number\">16</span><span class=\"token punctuation\">,</span>\n    textColor<span class=\"token operator\">:</span> <span class=\"token string\">'#262626'</span><span class=\"token punctuation\">,</span>\n    textShadow<span class=\"token operator\">:</span> <span class=\"token string\">'0 0 1px #464646'</span><span class=\"token punctuation\">,</span>\n    iconShadow<span class=\"token operator\">:</span> <span class=\"token string\">'0 0 1px #464646'</span><span class=\"token punctuation\">,</span>\n    fontFamily<span class=\"token operator\">:</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n    padding<span class=\"token operator\">:</span> <span class=\"token number\">10</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function\">formConf</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">formData<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span>string<span class=\"token punctuation\">,</span>any<span class=\"token operator\">></span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// 传入formData以实现双向绑定</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      weatherMode<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        label<span class=\"token operator\">:</span> <span class=\"token string\">'天气城市'</span><span class=\"token punctuation\">,</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">'radio-group'</span><span class=\"token punctuation\">,</span>\n        radio<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          list<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'自动获取(IP)'</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'手动输入'</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          label<span class=\"token operator\">:</span> <span class=\"token string\">'name'</span><span class=\"token punctuation\">,</span>\n          value<span class=\"token operator\">:</span> <span class=\"token string\">'value'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      cityName<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function-variable function\">when</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">formData<span class=\"token operator\">:</span> Record<span class=\"token operator\">&lt;</span>string<span class=\"token punctuation\">,</span>any<span class=\"token operator\">></span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> formData<span class=\"token punctuation\">.</span>weatherMode <span class=\"token operator\">===</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 类似v-if</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">'input'</span><span class=\"token punctuation\">,</span>\n        attrs<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> placeholder<span class=\"token operator\">:</span> <span class=\"token string\">'请输入城市名(目前仅支持中国城市名)'</span><span class=\"token punctuation\">,</span> clearable<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        rules<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n          required<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n          <span class=\"token function-variable function\">validator</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>rule<span class=\"token operator\">:</span> <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">,</span> value<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token function-variable function\">callback</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e<span class=\"token operator\">?</span><span class=\"token operator\">:</span>Error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n            formData<span class=\"token punctuation\">.</span>weatherMode <span class=\"token operator\">===</span> <span class=\"token number\">2</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>value <span class=\"token operator\">?</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">'请输入城市名'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">}</span> \n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> <span class=\"token comment\">// 支持el-form原生rule</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      animationIcon<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        label<span class=\"token operator\">:</span> <span class=\"token string\">'动画图标'</span><span class=\"token punctuation\">,</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">'switch'</span><span class=\"token punctuation\">,</span>\n        tips<span class=\"token operator\">:</span> <span class=\"token string\">'默认使用含动画的ICON，若想提高性能可关闭使用静态ICON'</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      duration<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        label<span class=\"token operator\">:</span> <span class=\"token string\">'自动刷新频率'</span><span class=\"token punctuation\">,</span>\n        type<span class=\"token operator\">:</span> <span class=\"token string\">'input-number'</span><span class=\"token punctuation\">,</span>\n        attrs<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">'controls-position'</span><span class=\"token operator\">:</span> <span class=\"token string\">'right'</span><span class=\"token punctuation\">,</span> min<span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span> max<span class=\"token operator\">:</span> <span class=\"token number\">12</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> \n        tips<span class=\"token operator\">:</span> <span class=\"token string\">'刷新频率,单位为分钟'</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token operator\">...</span><span class=\"token function\">pick</span><span class=\"token punctuation\">(</span>formData<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span> <span class=\"token comment\">// 选取公用的配置</span>\n        <span class=\"token string\">'position'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'baseFontSize'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'textColor'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'textShadow'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'iconShadow'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'fontFamily'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">'padding'</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 592px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 116.66666666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABJ0AAASdAHeZh94AAADl0lEQVQ4y51VWW8bVRS+f4l3eEDihfKA+sADi7q8AJUqWgQt6UIU13JJs5iSpKQkNJuzFIeKJyAsFS0g5QlUUKASUqQsbux4PJ7FMx7PYn+ccxxPx6n7AFc6mrt+95zvO+eOeua5F9F/dQSpoTGxgcHr6Etdw4UrQ8jemMaN6XmMjk/h5kwOn80uYnRiCpfSw2IX00O4SPt4b+radbxw9A2oV06eweaWhl9/uYe7d3/En388wP9t6ZFxAjxxBruPKnj491/Y2NjAzs7OwXKTrBVbq9VEs9mkbysGiKJI5upeQ8aXMx9DHXvr3cQGWqy70E0P28UAuhWiUA5QroYIQgIiMM/zUC5rqNUcOcMXMCi39y5noHIrqzLJtzmuC8syYdUaqNoRbCdCsdIGDqOW7Gv4PqrVKhznMWCnLefvQH299n086RJgrVajEEI8+MeD60UJhhiwmzMesnd8hin5Zu07qHfO9ccbyloF+6U9FEoOJlZ18a7tRQKk1YoNB4C6rrc5JOXV8VPvyyJzw9Zo+LQpkvt9PxALw4hCDYTjJGin7wfti8/2XYF6+2wfHQhRKpWwu1sglXeF8CCI5Ou6dQINYdouHQyfAGQP+Sy38x+SKAMfjXSF00mNgC5hz1gs/h72qjv89vnRsUmoscnp+CZWr1gsSeg+qRkEPlHQkLB7hXp47tb8ItRw9pMnMp7XGdSotST/WP319XVRsxdwpz8+OQU1n8vFk83mYwU9yn637otI7CVbL5Bkf3HlNtS3az/0rEvmkNVmwZjHJM+HU6hD2U/37kN9PrNwoPK+5JNpWsIfe+Y4Ljz6up4PwzSpLOs9gQzDkH5+lSrl3IUB8UDXq8IVh8rjdqi+8MnpZ1k2vKcAspjcJj4lDjOD2TgEzrtKRRdBeKNt29jc3MTW1pZEcbhSksDclpbzUKnMcHwTFzx7ygKwlyaFub29jb29PRqHT30HO6BzC0tQr504FU+yZwwaUCm1lfWlrOp1T4y9DIJuazQC4tcWjIH0INSRo8cTXBgoFB6JGFxyum5AowejSIIZhtlV2wFZKKUYwLG19nv4QQrq9ZOn5Wbe1Hko+RHopAv3OT/bJRiK5ywQ82s7Hn57WMPPv1som0CGylhd6k//53+HpmkwdA30XuB01sLL5/eRvw/c+XIZ6tnnX8Jc7jbZF2Lzi/muftIWllbjtdmFFczMrSA7sYyr2Rxmc1/h1WNv4l93CZ2GRkd6bwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"JSX生成的表单\"\n        title=\"JSX生成的表单\"\n        src=\"/blog/static/2ca61fd721ccc8c1437b8e8d80dfdaa1/d9142/standard-form.png\"\n        srcset=\"/blog/static/2ca61fd721ccc8c1437b8e8d80dfdaa1/a8a0d/standard-form.png 300w,\n/blog/static/2ca61fd721ccc8c1437b8e8d80dfdaa1/d9142/standard-form.png 592w\"\n        sizes=\"(max-width: 592px) 100vw, 592px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"右键菜单\" style=\"position:relative;\"><a href=\"#%E5%8F%B3%E9%94%AE%E8%8F%9C%E5%8D%95\" aria-label=\"右键菜单 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>右键菜单</h2>\n<p>物料组件添加后，在编辑模式下可以右键弹出菜单更改配置或删除等。右键菜单的实现来源与笔者开源的<code class=\"language-text\">@howdjs/mouse-menu</code>。同时在本项目中，为了兼容移动端，对插件进行了二次封装，为其添加了长按弹出菜单的功能。二次封装代码<a href=\"https://github.com/leon-kfd/Dashboard/blob/main/src/plugins/mouse-menu.ts\">参考此处</a>。</p>\n<p>项目中采用的是<code class=\"language-text\">vue指令</code>的方式使用，菜单插件可以接收任意参数进行回调，所以可以把点击的物料组件数据传到回调中进行各种操作。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">v-for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>element in affix<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>affix.id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">v-mouse-menu</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{ disabled: () => isLock, params: element, menuList }<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t\t\t<span class=\"token comment\">&lt;!--Material code--></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token function\">setup</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> isLock <span class=\"token operator\">=</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> store<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>isLock<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">const</span> menuList <span class=\"token operator\">=</span> <span class=\"token function\">ref</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n\t\t<span class=\"token punctuation\">{</span> label<span class=\"token operator\">:</span> <span class=\"token string\">'基础配置'</span><span class=\"token punctuation\">,</span> tips<span class=\"token operator\">:</span> <span class=\"token string\">'Edit Base'</span><span class=\"token punctuation\">,</span> <span class=\"token function-variable function\">fn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">params<span class=\"token operator\">:</span> ComponentOptions</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">emit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'edit'</span><span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">.</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\t\t<span class=\"token punctuation\">{</span> label<span class=\"token operator\">:</span> <span class=\"token string\">'删除'</span><span class=\"token punctuation\">,</span> tips<span class=\"token operator\">:</span> <span class=\"token string\">'Delete'</span><span class=\"token punctuation\">,</span> <span class=\"token function-variable function\">fn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">params<span class=\"token operator\">:</span> ComponentOptions</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> store<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'deleteComponent'</span><span class=\"token punctuation\">,</span> params<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token comment\">// fn中的params为组件数据</span>\n<span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p><img src=\"/blog/4f3b49b6fbaff2502f66eff536421b1d/mouse-menu.gif\" alt=\"右键菜单\"></p>\n<h2 id=\"物料组件布局\" style=\"position:relative;\"><a href=\"#%E7%89%A9%E6%96%99%E7%BB%84%E4%BB%B6%E5%B8%83%E5%B1%80\" aria-label=\"物料组件布局 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>物料组件布局</h2>\n<p>当前提供2中布局方式，一种是基于类文件流的栅格布局，这种布局会让组件一个接一个排列，另外一个是Fixed布局，可以让组件固定与页面任意位置。</p>\n<h3 id=\"栅格模式\" style=\"position:relative;\"><a href=\"#%E6%A0%85%E6%A0%BC%E6%A8%A1%E5%BC%8F\" aria-label=\"栅格模式 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>栅格模式</h3>\n<p>栅格模式使用<a href=\"https://github.com/jbaysolutions/vue-grid-layout\">vue-grid-layout</a>实现，该插件vue3版本处于Beta中。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>grid-layout</span> <span class=\"token attr-name\"><span class=\"token namespace\">v-model:</span>layout</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>list<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:col-num</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>12<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:row-height</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rowHeight<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:is-draggable</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>!isLock<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:is-resizable</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>!isLock<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>grid-item</span> <span class=\"token attr-name\">v-for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item in list<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:x</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.x<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:y</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.y<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:w</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.w<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:h</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.h<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">:i</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>item.i<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n\t\t\t<span class=\"token comment\">&lt;!--Material code--></span>\n\t\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>grid-item</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>grid-layout</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token function\">setup</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> isLock <span class=\"token operator\">=</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> store<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>isLock<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">const</span> list <span class=\"token operator\">=</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token function-variable function\">get</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> store<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>list<span class=\"token punctuation\">,</span>\n\t\t<span class=\"token function-variable function\">set</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span> store<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'updateList'</span><span class=\"token punctuation\">,</span> val<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>使用<code class=\"language-text\">v-model:layout</code>双向绑定栅格模式物料组件列表数据，因为物料数组存在vuex中，这里用<code class=\"language-text\">computed</code>的setter进行更新。<code class=\"language-text\">isLock</code>是用于判断当前是否处于编辑模式，在锁定状态下禁用拖拽与大小更改。当前使用的栅格数为12，即将屏幕宽度分割为12份。</p>\n<p><img src=\"/blog/4372ba7d6128741e1d884a7195678069/vue-grid-layout1.gif\" alt=\"栅格模式\"></p>\n<h3 id=\"fixed模式\" style=\"position:relative;\"><a href=\"#fixed%E6%A8%A1%E5%BC%8F\" aria-label=\"fixed模式 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Fixed模式</h3>\n<p>Fixed模式使用笔者自己开源的<a href=\"https://kongfandong.cn/howdy/to-control\">@howdjs/to-control</a>插件完成，可以让物料组件固定在页面的任何位置中，也支持拖拽右下角更改大小。</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\n\t\t<span class=\"token attr-name\">v-for</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>element in affix<span class=\"token punctuation\">\"</span></span>\n\t\t<span class=\"token attr-name\">v-to-control</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{\n\t\t\tpositionMode: element.affixInfo.mode,\n\t\t\tmoveCursor: false,\n\t\t\tdisabled: () => isLock,\n\t\t\tarrowOptions: { lineColor: <span class=\"token punctuation\">'</span>#9a98c3<span class=\"token punctuation\">'</span>, size: 12, padding: 8 }\n\t\t}<span class=\"token punctuation\">\"</span></span>\n\t\t<span class=\"token attr-name\">:key</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>element.id<span class=\"token punctuation\">\"</span></span>\n\t\t<span class=\"token attr-name\">@todragend</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>handleAffixDragend($event, element)<span class=\"token punctuation\">\"</span></span>\n\t\t<span class=\"token attr-name\">@tocontrolend</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>handleAffixDragend($event, element)<span class=\"token punctuation\">\"</span></span>\n\t<span class=\"token punctuation\">></span></span>\n\t\t<span class=\"token comment\">&lt;!--Material code--></span>\n\t<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token function\">setup</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">const</span> isLock <span class=\"token operator\">=</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> store<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>isLock<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">const</span> affix <span class=\"token operator\">=</span> <span class=\"token function\">computed</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> store<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">.</span>affix<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleAffixDragend</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">$event<span class=\"token operator\">:</span> any<span class=\"token punctuation\">,</span> element<span class=\"token operator\">:</span> ComponentOptions</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">const</span> mode <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span>affixInfo<span class=\"token operator\">?.</span>mode <span class=\"token operator\">||</span> <span class=\"token number\">1</span>\n\t\t<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> left<span class=\"token punctuation\">,</span> top<span class=\"token punctuation\">,</span> bottom<span class=\"token punctuation\">,</span> right<span class=\"token punctuation\">,</span> width<span class=\"token punctuation\">,</span> height <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> $event\n\t\t<span class=\"token keyword\">const</span> _element <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">stringify</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t_element<span class=\"token punctuation\">.</span>affixInfo<span class=\"token punctuation\">.</span>x <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>mode<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> left <span class=\"token operator\">:</span> right\n\t\t_element<span class=\"token punctuation\">.</span>affixInfo<span class=\"token punctuation\">.</span>y <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>mode<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> top <span class=\"token operator\">:</span> bottom\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>width <span class=\"token operator\">&amp;&amp;</span> height<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t_element<span class=\"token punctuation\">.</span>w <span class=\"token operator\">=</span> width\n\t\t\t_element<span class=\"token punctuation\">.</span>h <span class=\"token operator\">=</span> height\n\t\t<span class=\"token punctuation\">}</span>\n\t\tstore<span class=\"token punctuation\">.</span><span class=\"token function\">commit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'editComponent'</span><span class=\"token punctuation\">,</span> _element<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>与栅格模式不同，这里是使用事件回调函数对组件的Vuex数据进行更新。也是使用<code class=\"language-text\">isLock</code>判断组件是否锁定。插件支持更改定位方向，记录在右上角、右下角等，这样对响应式布局很有效。更多用法可参考: <a href=\"https://kongfandong.cn/howdy/to-control/example3\">@howdjs/to-control</a></p>\n<p><img src=\"/blog/579e9870838e6eceed2409aaf329eabc/to-control.gif\" alt=\"Fixed模式\"></p>\n<h2 id=\"交互弹窗popover\" style=\"position:relative;\"><a href=\"#%E4%BA%A4%E4%BA%92%E5%BC%B9%E7%AA%97popover\" aria-label=\"交互弹窗popover permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>交互弹窗Popover</h2>\n<p>系统提供一种配置交互行为的功能，可以配置点击一个组件时弹窗另外一个组件，并配置组件弹出的方向。经过调研后发现<code class=\"language-text\">Element-plus</code>的<code class=\"language-text\">Popover</code>并不太适合用于这种情况，因为弹出的组件时动态的。于是就自己封装了一个组件，不仅支持配置<code class=\"language-text\">Popover</code>的各个方向，还另外扩展了一个<code class=\"language-text\">ScreenCenter</code>的弹出，让组件可以在屏幕中间弹出（类似<code class=\"language-text\">dialog</code>）。</p>\n<p>通过传入点击的元素、目标弹窗的宽高和弹窗方向，返回出目标弹窗的<code class=\"language-text\">x</code>和<code class=\"language-text\">y</code>。核心代码如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">/**\n * 获取Popover目标信息\n * @param element 来源DOM\n * @param popoverRect popover信息\n * @param direction popover方向\n * @returns [endX, endY, fromX, fromY]\n */</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getPopoverActivePointByDirection</span><span class=\"token punctuation\">(</span>\n  element<span class=\"token operator\">:</span> HTMLElement<span class=\"token punctuation\">,</span>\n  popoverRect<span class=\"token operator\">:</span> PopoverOption<span class=\"token punctuation\">,</span>\n  direction <span class=\"token operator\">=</span> DirectionEnum<span class=\"token punctuation\">.</span><span class=\"token constant\">BOTTOM_CENTER</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> width<span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">,</span> top<span class=\"token punctuation\">,</span> left <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span><span class=\"token function\">getBoundingClientRect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> width<span class=\"token operator\">:</span> popoverWidth<span class=\"token punctuation\">,</span> height<span class=\"token operator\">:</span> popoverHeight<span class=\"token punctuation\">,</span> offset <span class=\"token operator\">=</span> <span class=\"token number\">10</span> <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> popoverRect\n  <span class=\"token keyword\">const</span> activePointMap <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">[</span>DirectionEnum<span class=\"token punctuation\">.</span><span class=\"token constant\">SCREEN_CENTER</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>window<span class=\"token punctuation\">.</span>innerWidth <span class=\"token operator\">/</span> <span class=\"token number\">2</span> <span class=\"token operator\">-</span> popoverWidth <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> window<span class=\"token punctuation\">.</span>innerHeight <span class=\"token operator\">/</span> <span class=\"token number\">2</span> <span class=\"token operator\">-</span> popoverHeight <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>DirectionEnum<span class=\"token punctuation\">.</span><span class=\"token constant\">TOP_START</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>left<span class=\"token punctuation\">,</span> top <span class=\"token operator\">-</span> popoverHeight <span class=\"token operator\">-</span> offset<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>DirectionEnum<span class=\"token punctuation\">.</span><span class=\"token constant\">TOP_CENTER</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>left <span class=\"token operator\">+</span> width <span class=\"token operator\">/</span> <span class=\"token number\">2</span> <span class=\"token operator\">-</span> popoverWidth <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> top <span class=\"token operator\">-</span> popoverHeight <span class=\"token operator\">-</span> offset<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>DirectionEnum<span class=\"token punctuation\">.</span><span class=\"token constant\">TOP_END</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>left <span class=\"token operator\">+</span> width <span class=\"token operator\">-</span> popoverWidth<span class=\"token punctuation\">,</span> top <span class=\"token operator\">-</span> popoverHeight <span class=\"token operator\">-</span> offset<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>DirectionEnum<span class=\"token punctuation\">.</span><span class=\"token constant\">RIGHT_START</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>left <span class=\"token operator\">+</span> width <span class=\"token operator\">+</span> offset<span class=\"token punctuation\">,</span> top<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>DirectionEnum<span class=\"token punctuation\">.</span><span class=\"token constant\">RIGHT_CENTER</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>left <span class=\"token operator\">+</span> width <span class=\"token operator\">+</span> offset<span class=\"token punctuation\">,</span> top <span class=\"token operator\">+</span> height <span class=\"token operator\">/</span> <span class=\"token number\">2</span> <span class=\"token operator\">-</span> popoverHeight <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>DirectionEnum<span class=\"token punctuation\">.</span><span class=\"token constant\">RIGHT_END</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>left <span class=\"token operator\">+</span> width <span class=\"token operator\">+</span> offset<span class=\"token punctuation\">,</span> top <span class=\"token operator\">+</span> height <span class=\"token operator\">-</span> popoverHeight<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>DirectionEnum<span class=\"token punctuation\">.</span><span class=\"token constant\">BOTTOM_END</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>left <span class=\"token operator\">+</span> width <span class=\"token operator\">-</span> popoverWidth<span class=\"token punctuation\">,</span> top <span class=\"token operator\">+</span> height <span class=\"token operator\">+</span> offset<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>DirectionEnum<span class=\"token punctuation\">.</span><span class=\"token constant\">BOTTOM_CENTER</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>left <span class=\"token operator\">+</span> width <span class=\"token operator\">/</span> <span class=\"token number\">2</span> <span class=\"token operator\">-</span> popoverWidth <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> top <span class=\"token operator\">+</span> height <span class=\"token operator\">+</span> offset<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>DirectionEnum<span class=\"token punctuation\">.</span><span class=\"token constant\">BOTTOM_START</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>left<span class=\"token punctuation\">,</span> top <span class=\"token operator\">+</span> height <span class=\"token operator\">+</span> offset<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>DirectionEnum<span class=\"token punctuation\">.</span><span class=\"token constant\">LEFT_END</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>left <span class=\"token operator\">-</span> popoverWidth <span class=\"token operator\">-</span> offset<span class=\"token punctuation\">,</span> top <span class=\"token operator\">+</span> height <span class=\"token operator\">-</span> popoverHeight<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>DirectionEnum<span class=\"token punctuation\">.</span><span class=\"token constant\">LEFT_CENTER</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>left <span class=\"token operator\">-</span> popoverWidth <span class=\"token operator\">-</span> offset<span class=\"token punctuation\">,</span> top <span class=\"token operator\">+</span> height <span class=\"token operator\">/</span> <span class=\"token number\">2</span> <span class=\"token operator\">-</span> popoverHeight <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>DirectionEnum<span class=\"token punctuation\">.</span><span class=\"token constant\">LEFT_START</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>left <span class=\"token operator\">-</span> popoverWidth <span class=\"token operator\">-</span> offset<span class=\"token punctuation\">,</span> top<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> fromPoint <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>left <span class=\"token operator\">+</span> width <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> top <span class=\"token operator\">+</span> height <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>activePointMap<span class=\"token punctuation\">[</span>direction<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>fromPoint<span class=\"token punctuation\">]</span> <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span>fromPoint<span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>另外，使用<code class=\"language-text\">transform-origin</code>这个属性可以实现弹窗从点击元素过渡展开的动画。最后配置弹窗的方向与弹出的组件类型即可。代码参考：<a href=\"https://github.com/leon-kfd/Dashboard/blob/main/src/components/Action/ActionPopover.vue\">ActionPopover.vue</a></p>\n<p><img src=\"/blog/99c491d75659251d0d9cca1c591aca6f/popover.gif\" alt=\"不同方向的Popover\"></p>\n<h2 id=\"获取任意网站favicon\" style=\"position:relative;\"><a href=\"#%E8%8E%B7%E5%8F%96%E4%BB%BB%E6%84%8F%E7%BD%91%E7%AB%99favicon\" aria-label=\"获取任意网站favicon permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>获取任意网站Favicon</h2>\n<p>在<code class=\"language-text\">Collection</code>与<code class=\"language-text\">Search</code>组件中，都有用到一个功能，就是由用户输入网址后能自动获取到网站的Favicon。在初版实现是直接使用网址origin + /favicon.ico获取，但经过大量尝试后发现，当前很多网站的icon并不是以这种标准形式存储的。所以后面就自己实现了一个后端接口来获取。</p>\n<p>后端接口原理:</p>\n<ol>\n<li>从用户输入的网站中读取到origin</li>\n<li>尝试从<code class=\"language-text\">Redis</code>中读取已缓存的图标路径，读取到则返回</li>\n<li>若缓存中没有，这使用<code class=\"language-text\">cheerio</code>加载网站，使用<code class=\"language-text\">$('link[rel*=\"icon\"]').attr('href')</code>读取图标路径</li>\n<li>若上一步没有读取到，则继续尝试使用标准形式读取，即网站Origin + /favicon.ico</li>\n<li>读取成功则写入<code class=\"language-text\">Redis</code>缓存，否则返回获取失败</li>\n</ol>\n<p>同时接口接收<code class=\"language-text\">type</code>参数，可由后端直接返回图片流，以解决一些网站的ICON资源做了CORS限制。因为在<code class=\"language-text\">Collection</code>组件中，为了减少初次访问请求加载数，前端读取到图标后会将图标转成BASE64格式存到本地存储中。这种方式需要使用Ajax获取图标，让接口直接返回文件流可以解决跨域问题。</p>\n<p>另读取图标时，前端会使用Canvas通道法将图标的白色部分扣成透明，代码可<a href=\"https://github.com/leon-kfd/Dashboard/blob/main/src/utils/images.ts#L40\">参考此处</a></p>\n<p><img src=\"/blog/c98266cb3f52d521eb21b0bb15e26b6b/favicon.gif\" alt=\"添加网站自动获取图标\"></p>\n<h2 id=\"总结\" style=\"position:relative;\"><a href=\"#%E6%80%BB%E7%BB%93\" aria-label=\"总结 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>总结</h2>\n<p>项目仍在持续优化开发中，欢迎各种建议。由于篇幅问题，部分使用到的技术会不定时更新记录。若感谢的可以持续关注、Star，谢谢。</p>\n<h3 id=\"相关链接\" style=\"position:relative;\"><a href=\"#%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5\" aria-label=\"相关链接 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>相关链接</h3>\n<ul>\n<li><a href=\"https://howdz.vercel.app\">Howdz介绍文档</a></li>\n<li><a href=\"https://github.com/leon-kfd/Dashboard/\">Github</a></li>\n<li><a href=\"https://s.kongfandong.cn\">在线网页版地址</a></li>\n</ul>","frontmatter":{"title":"Howdz起始页开发记录","date":"November 21, 2021","description":"Howdz是基于Vue3开发的一个完全自定义配置的浏览器导航起始页，支持按需添加物料组件，可自由编辑组件的位置、大小与功能。支持响应式设计，可自定义随机壁纸、动态壁纸等。项目提供网页在线访问、打包出浏览器插件、打包出桌面应用(Electron)等访问方式。"}}},"pageContext":{"slug":"/design-of-howdz/","previous":{"fields":{"slug":"/g-music-visualizer/"},"frontmatter":{"title":"利用G渲染器实现的音频可视化方案"}},"next":null}},"staticQueryHashes":["143701507","165057280"]}